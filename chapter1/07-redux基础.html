<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redux基本介绍 | react 快速上手</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="shortcut icon" type="image/x-icon" href="./images/favicon.ico">
    <meta name="description" content="杰哥哥前端研究院">
    
    <link rel="preload" href="/jiely/assets/css/0.styles.5afc0e25.css" as="style"><link rel="preload" href="/jiely/assets/js/app.87156db4.js" as="script"><link rel="preload" href="/jiely/assets/js/3.05e47443.js" as="script"><link rel="preload" href="/jiely/assets/js/13.46042c4c.js" as="script"><link rel="prefetch" href="/jiely/assets/js/10.1bb09252.js"><link rel="prefetch" href="/jiely/assets/js/11.7487ab28.js"><link rel="prefetch" href="/jiely/assets/js/12.a9e0b5c6.js"><link rel="prefetch" href="/jiely/assets/js/14.7e9485d0.js"><link rel="prefetch" href="/jiely/assets/js/15.82bd5665.js"><link rel="prefetch" href="/jiely/assets/js/16.da48c8d1.js"><link rel="prefetch" href="/jiely/assets/js/17.4c4fbca4.js"><link rel="prefetch" href="/jiely/assets/js/18.8f64b26e.js"><link rel="prefetch" href="/jiely/assets/js/19.6e619bb0.js"><link rel="prefetch" href="/jiely/assets/js/2.af879dde.js"><link rel="prefetch" href="/jiely/assets/js/20.a8659479.js"><link rel="prefetch" href="/jiely/assets/js/21.c50358c3.js"><link rel="prefetch" href="/jiely/assets/js/22.2b3cb2cc.js"><link rel="prefetch" href="/jiely/assets/js/23.ef2a71c6.js"><link rel="prefetch" href="/jiely/assets/js/24.713e58c4.js"><link rel="prefetch" href="/jiely/assets/js/25.9e2de17e.js"><link rel="prefetch" href="/jiely/assets/js/26.ebe2c2c7.js"><link rel="prefetch" href="/jiely/assets/js/27.b410c517.js"><link rel="prefetch" href="/jiely/assets/js/28.416e0f83.js"><link rel="prefetch" href="/jiely/assets/js/29.28bb402e.js"><link rel="prefetch" href="/jiely/assets/js/30.117590fb.js"><link rel="prefetch" href="/jiely/assets/js/31.012589f4.js"><link rel="prefetch" href="/jiely/assets/js/32.391074f7.js"><link rel="prefetch" href="/jiely/assets/js/33.3b5bff31.js"><link rel="prefetch" href="/jiely/assets/js/34.5f03808f.js"><link rel="prefetch" href="/jiely/assets/js/35.c836f09c.js"><link rel="prefetch" href="/jiely/assets/js/36.cdfd4095.js"><link rel="prefetch" href="/jiely/assets/js/37.3888e0de.js"><link rel="prefetch" href="/jiely/assets/js/38.9d42564b.js"><link rel="prefetch" href="/jiely/assets/js/39.af6cc2f1.js"><link rel="prefetch" href="/jiely/assets/js/4.cb17c8a3.js"><link rel="prefetch" href="/jiely/assets/js/40.28ea6c30.js"><link rel="prefetch" href="/jiely/assets/js/41.07ff3483.js"><link rel="prefetch" href="/jiely/assets/js/42.461144bb.js"><link rel="prefetch" href="/jiely/assets/js/43.7381291e.js"><link rel="prefetch" href="/jiely/assets/js/44.e99c69d5.js"><link rel="prefetch" href="/jiely/assets/js/45.82ace09a.js"><link rel="prefetch" href="/jiely/assets/js/46.6f99a05f.js"><link rel="prefetch" href="/jiely/assets/js/47.50c29aca.js"><link rel="prefetch" href="/jiely/assets/js/48.8de86252.js"><link rel="prefetch" href="/jiely/assets/js/49.7b800d70.js"><link rel="prefetch" href="/jiely/assets/js/5.8ae26c23.js"><link rel="prefetch" href="/jiely/assets/js/6.9b2d155f.js"><link rel="prefetch" href="/jiely/assets/js/7.276458e1.js"><link rel="prefetch" href="/jiely/assets/js/8.b230375e.js"><link rel="prefetch" href="/jiely/assets/js/9.fae1b1d4.js">
    <link rel="stylesheet" href="/jiely/assets/css/0.styles.5afc0e25.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/jiely/" class="home-link router-link-active"><img src="/jiely/images/logo.jpg" alt="react 快速上手" class="logo"> <span class="site-name can-hide">react 快速上手</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://juejin.cn/post/7097067108663558151" target="_blank" rel="noopener noreferrer" class="nav-link external">
  50+Vue经典面试题源码级
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://segmentfault.com/a/1190000018604138" target="_blank" rel="noopener noreferrer" class="nav-link external">
  react面试题
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://juejin.cn/post/6844904055840440334" target="_blank" rel="noopener noreferrer" class="nav-link external">
  从零React项目
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://summerjie007.github.io/vue3_study/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue3+TS
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/airbnb/javascript" target="_blank" rel="noopener noreferrer" class="nav-link external">
  代码规范
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://juejin.cn/post/7097067108663558151" target="_blank" rel="noopener noreferrer" class="nav-link external">
  50+Vue经典面试题源码级
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://segmentfault.com/a/1190000018604138" target="_blank" rel="noopener noreferrer" class="nav-link external">
  react面试题
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://juejin.cn/post/6844904055840440334" target="_blank" rel="noopener noreferrer" class="nav-link external">
  从零React项目
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://summerjie007.github.io/vue3_study/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue3+TS
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/airbnb/javascript" target="_blank" rel="noopener noreferrer" class="nav-link external">
  代码规范
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/jiely/00_课程介绍.html" class="sidebar-link">课程指南</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>一.react全家桶上手</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>React基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>React组件基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>React组件通讯</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>React组件通讯进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>react-hooks基础阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>react-hooks进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>redux基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jiely/chapter1/07-redux基础.html" class="active sidebar-link">Redux基本介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jiely/chapter1/07-redux基础.html#redux基本介绍" class="sidebar-link">Redux基本介绍</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter1/07-redux基础.html#问题导入-react多组件共享" class="sidebar-link">问题导入-react多组件共享</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter1/07-redux基础.html#redux-三个核心概念" class="sidebar-link">Redux 三个核心概念</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter1/07-redux基础.html#redux功能演示核心代码" class="sidebar-link">Redux功能演示核心代码</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter1/07-redux基础.html#redux-代码执行过程" class="sidebar-link">Redux 代码执行过程</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter1/07-redux基础.html#解决问题-redux在react中使用" class="sidebar-link">解决问题-redux在react中使用</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter1/07-redux基础.html#react-redux基本介绍" class="sidebar-link">React-redux基本介绍</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter1/07-redux基础.html#react-redux-基本使用" class="sidebar-link">react-redux-基本使用</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter1/07-redux基础.html#reducer-的分离与合并-思路" class="sidebar-link">Reducer 的分离与合并-思路</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter1/07-redux基础.html#reducer-的分离与合并-实现" class="sidebar-link">Reducer 的分离与合并-实现</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter1/07-redux基础.html#案例-todo-基本介绍" class="sidebar-link">案例-todo-基本介绍</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter1/07-redux基础.html#案例-todo-列表渲染" class="sidebar-link">案例-todo-列表渲染</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter1/07-redux基础.html#案例-todo-删除任务" class="sidebar-link">案例-todo-删除任务</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter1/07-redux基础.html#案例-todo-修改任务状态" class="sidebar-link">案例-todo-修改任务状态</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter1/07-redux基础.html#案例-todo-添加新任务" class="sidebar-link">案例-todo-添加新任务</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter1/07-redux基础.html#案例-todo-全选功能" class="sidebar-link">案例-todo- 全选功能</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter1/07-redux基础.html#案例-todo-双击-开启编辑" class="sidebar-link">案例-todo-双击-开启编辑</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter1/07-redux基础.html#案例-todo-双击-保存修改" class="sidebar-link">案例-todo-双击-保存修改</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter1/07-redux基础.html#案例-todo-双击-自动获取焦点-问题" class="sidebar-link">案例-todo-双击-自动获取焦点-问题</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter1/07-redux基础.html#案例-todo-清空已完成任务" class="sidebar-link">案例-todo-清空已完成任务</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter1/07-redux基础.html#案例-todo-底部筛选" class="sidebar-link">案例-todo-底部筛选</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter1/07-redux基础.html#拓展-纯函数" class="sidebar-link">拓展-纯函数</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter1/07-redux基础.html#拓展-在原生js中使用redux" class="sidebar-link">拓展-在原生js中使用redux</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>redux进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>react路由</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>二.react全家桶项目</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>三.前端算法之道</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>四.JS设计设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>五.JS报错总结</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>六.Vue3+Pinia</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>七.node.js</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="redux基本介绍"><a href="#redux基本介绍" class="header-anchor">#</a> Redux基本介绍</h2> <h3 id="目标"><a href="#目标" class="header-anchor">#</a> 目标</h3> <p>了解的Redux的基本内容；知道它在react技术栈中的位置。</p> <h3 id="redux"><a href="#redux" class="header-anchor">#</a> redux</h3> <p>文档：<a href="http://cn.redux.js.org/" target="_blank" rel="noopener noreferrer">redux 中文<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://redux.js.org/" target="_blank" rel="noopener noreferrer">redux 英文<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Redux 是 JavaScript 应用的状态容器，提供可预测的状态管理。</p> <p>当遇到如下问题时，建议开始使用 Redux：</p> <ul><li>你有很多数据随时间而变化</li> <li>你希望状态有一个唯一确定的来源</li> <li>你发现将所有状态放在顶层组件中管理已不可维护</li></ul> <h3 id="redux和react的关系"><a href="#redux和react的关系" class="header-anchor">#</a> redux和react的关系</h3> <p>Redux并不只为react应用提供状态管理， 它还支持其它的框架。</p> <h3 id="为什么rect要用-redux"><a href="#为什么rect要用-redux" class="header-anchor">#</a> 为什么Rect要用 Redux</h3> <p>React 是 DOM 的一个抽象层（UI 库），并不是 Web 应用的完整解决方案。因此react在涉及到<strong>数据的处理</strong>以及<strong>组件之间的通信</strong>时会比较复杂。</p> <p>对于大型的复杂应用来说，这两方面恰恰是最关键的。因此，只用 React，写大型应用比较吃力。</p> <ul><li>2014 年 Facebook 提出了 Flux 架构的概念，引发了很多的实现。</li> <li>2015 年，Redux 出现，将 Flux 与函数式编程（reducer）结合一起，很短时间内就成为了最热门的前端架构。</li> <li>Flux 是最早的状态管理 工具，它提供了状态管理的思想，也提供对应的实现</li> <li>除了 Flux、Redux 之外，还有：Mobx 等状态管理工具</li></ul> <p><img src="/jiely/assets/img/with-redux.a034a334.png" alt="with redux"></p> <ul><li>主要的区别：<strong>组件之间的通讯问题</strong></li> <li>不使用 Redux (图左边) ：
<ul><li>只能使用父子组件通讯、状态提升等 React 自带机制</li> <li>处理远房亲戚(非父子)关系的组件通讯时乏力</li> <li>组件之间的数据流混乱，出现 Bug 时难定位</li></ul></li> <li>使用 Redux (图右边)：
<ul><li><strong>集中式存储和管理应用的状态</strong></li> <li>处理组件通讯问题时，<strong>无视组件之间的层级关系</strong></li> <li>简化大型复杂应用中组件之间的通讯问题</li> <li>数据流清晰，易于定位 Bug</li></ul></li></ul> <h3 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h3> <ol><li>redux是？</li> <li>它的作用是？</li> <li>redux只能在react中使用么？</li></ol> <h2 id="问题导入-react多组件共享"><a href="#问题导入-react多组件共享" class="header-anchor">#</a> 问题导入-react多组件共享</h2> <h3 id="目标-2"><a href="#目标-2" class="header-anchor">#</a> 目标</h3> <p>分析问题，并搭建代码基本结构</p> <h3 id="问题描述"><a href="#问题描述" class="header-anchor">#</a> 问题描述</h3> <p>多组件（跨层级的）共享数据</p> <p><img src="/jiely/assets/img/image-20211112223850579.7a4bc0ef.png" alt="image-20211112223850579"></p> <h3 id="目录结构"><a href="#目录结构" class="header-anchor">#</a> 目录结构</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>├── src
   ├── store          <span class="token comment"># redux目录，一般约定叫store</span>
   │   ├── index.js   <span class="token comment"># 定义并导出store. 其中会导入reducer</span>
   │   └── reducer    <span class="token comment"># reducer函数</span>
   ├── App.js         <span class="token comment"># 根组件，引入Father 和 Uncle组件</span>
   ├── Father.js      <span class="token comment"># Father组件。其中引入了Son组件</span>
   ├── index.js       <span class="token comment"># 项目的入口文件，会导入并渲染App.js</span>
   ├── Son.js         <span class="token comment"># Son组件</span>
   └── Uncle.js       <span class="token comment"># Unclde组件</span>
</code></pre></div><h3 id="使用redux来解决的思路"><a href="#使用redux来解决的思路" class="header-anchor">#</a> 使用redux来解决的思路</h3> <p><img src="/jiely/assets/img/image-20211112224003085.4cc345cb.png" alt="image-20211112224003085"></p> <h3 id="小结-2"><a href="#小结-2" class="header-anchor">#</a> 小结</h3> <ol><li>redux可以无视组件层级</li> <li>对于组件系统来说，redux就是一个第三方的，全局的“变量”</li></ol> <h2 id="redux-三个核心概念"><a href="#redux-三个核心概念" class="header-anchor">#</a> Redux 三个核心概念</h2> <h3 id="目标-3"><a href="#目标-3" class="header-anchor">#</a> 目标</h3> <p>能够理解redux三个核心概念</p> <h3 id="图示"><a href="#图示" class="header-anchor">#</a> 图示</h3> <p><img src="/jiely/assets/img/image-20211112224019076.e78890cd.png" alt="image-20211112224019076"></p> <h3 id="理解三个核心概念"><a href="#理解三个核心概念" class="header-anchor">#</a> 理解三个核心概念</h3> <p>核心概念：<code>store</code>、<code>action</code>、<code>reducer</code></p> <h3 id="action"><a href="#action" class="header-anchor">#</a> action</h3> <ul><li><p>动作。</p></li> <li><p>一个js对象，包含两个属性：</p> <ul><li><strong>type</strong>： 标识属性，值是字符串。多个type用action分开</li> <li>payload：数据属性，可选。表示本次动作携带的数据</li></ul></li> <li><p>actions 只是描述了***有事情发生了***这一事实，并没有描述应用如何更新 state。</p></li> <li><p>特点：</p> <ul><li>只描述做什么</li> <li>JS 对象，必须带有 <code>type</code> 属性，用于区分动作的类型</li> <li>根据功能的不同，可以携带额外的数据，配合该数据来完成相应功能</li></ul></li></ul> <p>示例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// action</span>
<span class="token punctuation">{</span> type： <span class="token string">'increment'</span> <span class="token punctuation">}</span> <span class="token comment">// +1</span>
<span class="token punctuation">{</span> type： <span class="token string">'decrement'</span><span class="token punctuation">,</span> count： <span class="token number">2</span> <span class="token punctuation">}</span> <span class="token comment">// -1</span>

<span class="token comment">// todomvc 案例</span>
<span class="token comment">// { type: 'addTodo' }</span>
<span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'addTodo'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'吃饭'</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'addTodo'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'睡觉'</span> <span class="token punctuation">}</span>
<span class="token comment">// { type: 'removeTodo' }</span>
<span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'removeTodo'</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span>
</code></pre></div><h3 id="reducer"><a href="#reducer" class="header-anchor">#</a> reducer</h3> <ul><li><p>一个<strong>纯函数</strong></p></li> <li><p>作用</p> <ul><li><ol><li><strong>初始化状态</strong></li> <li><strong>修改状态</strong></li></ol></li></ul></li> <li><p>修改状态</p> <p>根据传入的旧状态和action，返回新状态</p> <p>公式：<code>(previousState, action) =&gt; newState</code></p></li></ul> <p>示例</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'add'</span><span class="token operator">:</span>
      <span class="token comment">// 返回新的state</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">case</span> <span class="token string">'addN'</span><span class="token operator">:</span>
      <span class="token comment">// 返回新的state</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> action<span class="token punctuation">.</span>payload
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="store"><a href="#store" class="header-anchor">#</a> store</h3> <ul><li>store：仓库，Redux 的核心，整合 action 和 reducer</li> <li>特点：
<ul><li><strong>一个应用只有一个 store</strong></li> <li>维护应用的状态，获取状态：<code>store.getState()</code></li> <li>创建 store 时<strong>接收 reducer 作为参数</strong>：<code>const store = createStore(reducer)</code></li> <li>发起状态更新时，需要分发 action：<code>store.dispatch(action)</code></li></ul></li> <li>其他 API，
— 订阅(监听)状态变化：<code>const unSubscribe = store.subscribe(() =&gt; {})</code>
— 取消订阅状态变化： <code>unSubscribe()</code></li></ul> <h2 id="redux功能演示核心代码"><a href="#redux功能演示核心代码" class="header-anchor">#</a> Redux功能演示核心代码</h2> <blockquote><p>安装redux <code>npm i redux</code></p></blockquote> <h3 id="目标-4"><a href="#目标-4" class="header-anchor">#</a> 目标</h3> <p>通过一段代码，来对应理解redux中的三个核心概念，并学习相关的api</p> <h3 id="三个核心概念对应的代码"><a href="#三个核心概念对应的代码" class="header-anchor">#</a> 三个核心概念对应的代码</h3> <h4 id="定义reuder"><a href="#定义reuder" class="header-anchor">#</a> 定义reuder</h4> <div class="language-js extra-class"><pre class="language-js"><code>initState <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> initState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> state
<span class="token punctuation">}</span>
</code></pre></div><h4 id="定义action"><a href="#定义action" class="header-anchor">#</a> 定义action</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> action1 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'addN'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token number">12</span> <span class="token punctuation">}</span>
<span class="token comment">// store.dispatch(action1)</span>

<span class="token keyword">const</span> action2 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
</code></pre></div><h4 id="定义store"><a href="#定义store" class="header-anchor">#</a> 定义store</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token comment">// 创建 store</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>
</code></pre></div><h3 id="store-相关api"><a href="#store-相关api" class="header-anchor">#</a> store 相关API</h3> <ol><li>store获取状态  <code>store.getState()</code></li> <li>store修改数据，通过派发action。<code>store.dispatch({type:xxx, payload: xx}})</code></li> <li>store添加订阅者。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//  格式：</span>
<span class="token comment">//  取消订阅 = store.subscribe(订阅者)</span>

<span class="token comment">//  订阅者：就是一个函数，当state值变化时，store会执行它</span>
<span class="token comment">//  store.subscript()的返回值也是一个函数，执行它时，它的</span>
<span class="token keyword">const</span> unSubscribe <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 状态改变时，执行相应操作</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 取消监听状态变化</span>
<span class="token comment">// unSubscribe()</span>
</code></pre></div><ol start="4"><li>取消订阅者。<code>unSubscribe()</code></li></ol> <h3 id="核心代码"><a href="#核心代码" class="header-anchor">#</a> <strong>核心代码</strong></h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>

initState <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> initState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> state
<span class="token punctuation">}</span>
<span class="token comment">// 创建 store</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>

<span class="token comment">// store获取状态</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 更新状态</span>
<span class="token comment">//     1. dispatch 派遣，派出。表示：分发一个 action，也就是发起状态更新</span>
<span class="token comment">//     2. store.dispatch会 调用reducer函数，并将action传递给reducer</span>
<span class="token keyword">const</span> action1 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'addN'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token number">12</span> <span class="token punctuation">}</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action1<span class="token punctuation">)</span>

<span class="token keyword">const</span> action2 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action2<span class="token punctuation">)</span>

<span class="token comment">// store 添加订阅者</span>
<span class="token comment">//  store.subscribe</span>
<span class="token comment">//  订阅者：就是一个函数，当state值变化时，store会执行它</span>
<span class="token keyword">const</span> unSubscribe <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 状态改变时，执行相应操作</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据变化了....'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 取消监听状态变化</span>
<span class="token function">unSubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="redux-代码执行过程"><a href="#redux-代码执行过程" class="header-anchor">#</a> Redux 代码执行过程</h2> <h3 id="获取默认值"><a href="#获取默认值" class="header-anchor">#</a> 获取默认值</h3> <p>只要创建 store，那么，Redux 就会调用一次 reducer， 且type是一个随机值。如下是一个示例:</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAaoAAAAdCAYAAAD7NyiPAAAMTElEQVR4nO2db2wT5x3HP15AAkVEkQLIQQ6rwZRVItuIshFHqlSSsWpdhcBZQE1UNS1pVOiLSREVaJggEoeygngxCUojoEgoTklGYIypXSkUiSl2wDPagkZTTF0SK2cRLKWdApVYdHtxZ/ts3yWOkxCnfT6SBb7nnn/n8/N9ft/nOccky7KMQCAQCARZyrxvvvlmttsgEAgEAoEhJhFRCQQCgSCb+dFsN0AgEAgEgvEQQiUQCASCrEYIlUAgEAiyGiFUAoFAIMhqhFAJBAKBIKsRQiUQCASCrEYIlUAgEAiymlkWqmHOvrEK64pVWA/emt2mCASC7MB3UBkTVrzJ2fBsN0aQDUxJqC5cvMSFi3/LOL//YDm7OcCNr+4S3L12Kk3JYjzcNpnobfHoJ4fc+EwmetXXba9BfvXl65jhb27Ijc9URX9o5qoYaDHRu8VNBIAw/Vvi/Yu/WhkAYv2PnR/PE7sW3lad/NF0o/JN9Gr6OdBilH82SPzMDe+dLETvOur3YZzvRelugl/d5VzDNXafFhNYASBPgfN/+av82ra35HffOyIPDz+cZG6/3Gqtlz+SDJL/+YH82rYP5P9MpYHZwGC7fBPkPk9q0kO3Q/biku8nnKt573HJXhzyF4PRAz1yX8L7GcDjSmzTUytfkr+oRr7pTroh1OuXmMfgOkzU9sF2+abu9VPq1vuMnj49ch8612GuYnT/j/O9iPKgq15+5l3/jDZPMDeYFuvvi/4vaWpu5dPPrqafKRwgwEpWmfWTh4ckKP0Fz01HA2eTUJAxHMy3JB33thKoKaFQ3sPy6DFLBYuqnXzrRYls7H7yB8+xOpbXTl5zN/+9PnMz/UjQD80V8TZNKx5u253kevbolB/kSRcssCbeEJHr5xirdpEbvS4AoSDfUcLCpGsaCfqh2kquUfWhIGM6+ZS6dT6j2cB7ldHqdqyvGHwx5hRh+htrGWvuYU1ZUpLR90LDYOAa623Z8KEIZptpW6N69Ogx7o+6+NPR4zx69HjC84f/8Smfv7CSooSjYa44t1NXv513LoTB10ZdvfK+zvkxwwD+Nurq27ijzZZwTCnjjB/uHN8ey++6lDS4hz/GVR9PrzuuYzGoXvkbfx6e1LVIoGwP62St2Cht7D/iJ38wecA2s7BY+d/Ah7Us8CTng1ybI16Gan9FOqoMLZaEND1rMck2C9R0k2OzKmkhN76YBae2q0VTh2pbJlhkanl6tlmk4zCj1e0UJg9aoIpP6sA1GuiG4gryimH0sid27piOICnnWinQKR7GETID4ZscqRZjJtbhwGXnuH0wxNuqsUvHOTYhqf1ItaPTbdNJRrpcFO61p6bpfi+0DHP3S7A9syTDygXfJ6Z9M4X/1r/Yu9814XmDgWusf+kFEm9DM5Wu9zl9ooFKoHLH+5w+ob5cv1HOXVaEDYkhzRhw58YtMBexGACJobCZ+93bOWfZp+TdsZbAhYtxcfO3Uee8gd0VLb+BSl8bZ/zTcQXSwHuSkeKdrLYkevqxge2Bmwd9yoA+nggBcP5tAoGdrJNl1g22k9N0OGHdJXC+CpssK+keF6P2+MAV6aii1+4nf1BNl3vIJR7VKNGMdmAP87iPuJBZarC6HYwFgmq/WmPllSZHBCE3wRrIP1KjPwjrRjtKfbkb7IpA9wWJoApOymCe1DYdRgPd5GyuSK0/FGQMJ1LK+lj6DLQUMlLco15H5ZVyDYzQrFNKTUBT+eTXpyxWcvDzWLO2OHDZOX6EmYKH26bUfqREQ+mWZXeS4942Q9G54IfEtAtVyc9/Rss+p0FqfJffJ7+6y6nfGcyWwmHus5bSEp00s5kfE2ZoKHrgFj4fVDpUIQuHuU8YyvbhfFlvoLjFmWO3qNyxj8pocjjMfb12qIu6hu3MiDD9R5zkbrAT6ahC6mvHJveQi4ulr8DjPgf/u14LmysoiNmDEvnVDvJftzMa6FaFRLHKxqjCpjdj9bYiNbko7IwLQySoVWIPUk03udqoLSmqSY1QUu25gleOkt93lYGYSOnNkhULCPdRwxm0frQTt+QKnq8ip+scD0Oq4KQIkr51qO3vt00G6WV7NAOzRH61Eylh88ZEKCKZMZYaSjUThVxPXCTW6X22umVYWUA3T2JCpfQ3t9FgYqDDQEs5o8096dc5UVlTsjCXsPVUJ2xZhXXFQZ7WHFKQncybroIWLlzI5o0v8+sNFeOctYStp+6y1XcQ67Eu3jxVjZ4EDPtuEDD/Uo2QkllLaSmcGwpDiZnhSxe5Yt7IoaioDQ0SYC27dEUK8N/kCsCx7cq/KpU73udVPWGcdoI86XKR1+lBskP+YI0iSM0VrAldxdf1LPOqHSz6PfQ3Osn1yCwPufFRhdXiQWpyMP91VFFJGogsNZTKNQAMfKhMFiSTEylWtyu+Jua9yiiuBBtOiaCqWGyBWISyWSMIOnnAzOpG6LUrbdUVIu9JRmjHZjhohXl4vpuczUcTB1XVksuzAEQHYg9PmmCBJ6ks3bYll+Vg0YT2npnFmx2MnJ/ovMQ8qzt7uG0qp7cJwGEg2BMQCvIdLpZmFMHYyWuGB8EwlJljNqst7bJUYfNMXaSUSZJDubczLcN3EOsWOPfVXf4w9RYJ5jjTIlQ/Wb2K+tdfY/HiNG9Ly0rWX7vHIOgK1cNQGCxm3TSAxRYzgZAESHxyAV6N2oKomzCSRO7OjVtQ2hDfmGHeyCFNnqeK9yqjzRWsCQXxVVdRaAkrgtQoE7l+mLGdP4X7VSy2BJG6XOR1wkBLLWyWKPCeJFBdhc0CeIOM4SJvnIEoxy0Z2k9KBFOliWCUCIvmnergokQzi47Ewk76jzihuj0x6olFUj08aXQT6UwenKIbKORxBi01GmpMtgu1a1HKQCwdOUyOjuCk9icJw40UySiiSfHOSQ6ydtaof9ot0lFFoKiVAVlv04gx0YlC+lZdIrm2qA0bRKphckKRtpBPRNTykyYv1Br8n51k/Xs9PJW5oyDrmbL1t2njb9n9TmP6IgUQuqezkSJ9liwrhFCYK8fbQGvhoYicrWxtXLgu7eePvrXsekvznFb4Bv+eaJ17OjZS6BAJ+hXbKhRkDNQFZwfzLR5lcHl+HmPFVgrUiImQmwdNsMCKYhmqEVQ6u/PGzl81tK8KrCXQFWQUUBbQy9X/q0Trj6UXMtJFohWYYPfZySuuJZi0gSBqJ427zmGwkSJ5Y8HyDS7o6tZEfXEy3kiRQLSfqRsAYmuF6a4ZpdQVfTbK+Bm1CfswQRsKrCXQF6S/pRx0NuKM2wbVOhz5cPz+TdSGgZZyRnGxdEq7FsVGCkEiU4qoNm18OaN8w1/fg2dfNIxontu0EZuzjbp65b1tU9J607IibOGLnLE0cDphyhVmKAQB337qLqiHzBs5dEITPZU0cGjTft5xbueMJmey9Tf89T2l7pn6slis5HTVEqCd/GYnI0Xd5Lgl1iw9Sa+avoBapCIX+W4HI/ZCaO5hXZnSz6hVZsTyvRKPtxQSMNUSiB3VWH9l28ivLoxZg7kemcJiEw9iGyUqWFRdy0iRiV6U6My2+W0CAaX+qHBp7b5cm4Oxmrfpf14dJKPrZLK+nRTpqCJQ0x17r9QVtc10rEeLlRxQhBxQBl6twKrWm846iyICqVFSchto7mFdp7H9lbo2ltwGUK6zUTRjFNXp9DftNqio99RIcfQ+MUKvDXbWDLbjK4ralzCehanbBm8rUhMGjx9MhhD3rr3AygNTKkTwPWIW/hT9MGffKOfvL/VkvknB30bdMdh1oiHxOavwx7icN7C7EqOsrMLbSu/lCuMF65AbXyNYUyy0uYYiZk8aM9019kPDw23TYeZnsrYVxdtKr53EZ/PmIrH1qd3C+hMAs/hbf58HMvyNHn8bdcckXnU1pD4MPDRIgEKWZatIgTLr1WwhBxho0WyHtlhZ0FWLpHl2JdLROqM/aTQTDLQUMoLBM1OCFJRdcqmWZtrEbNg5LlIMc/bYSWh4UYiUIMYsCNUSth44wPq2LZP60cnhS/uVB3OPwa4T+hHTnPg1C0sNpZ4SxeaKPjuDdq1JsWC+s2sewj1vzXwAmyWW75VZN+ejwpkm/nCt1NeOLYPrFVszskPhuA/QZj/+g6uwrihn97Od3+Pf/hRkwixYfwKBQCAQpI/4e1QCgUAgyGqEUAkEAoEgqxFCJRAIBIKsRgiVQCAQCLKa/wPWD8wuhZ7EfQAAAABJRU5ErkJggg==" alt="image-20211113092840686"></p> <ul><li>type是随机值确保了它不会被用户业务逻辑处理，而只能去匹配默认值。</li></ul> <p>这一次调用 reducer 的目的：<strong>获取状态的默认值</strong>。这个初始值将成为下一次调用 <code>store.getState()</code> 方法来获取 Redux 状态值的preState</p> <h3 id="更新状态"><a href="#更新状态" class="header-anchor">#</a> 更新状态</h3> <ol><li>当你需要更新状态时，就先分发动作 <code>store.dispatch(action)</code></li> <li>Redux 内部，store 就会调用 reducer，传入：上一次的状态（当前示例中就是：<code>0</code>）和 action（<code>{ type: 'add' }</code>），计算出新的状态，并返回这个新值。</li> <li>reducer 执行完毕后，将最新的状态交给 store，store 用最新的状态替换旧状态，状态更新完毕</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'reducer:'</span><span class="token punctuation">,</span> state<span class="token punctuation">,</span> action<span class="token punctuation">)</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'add'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'状态值为：'</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 10</span>

<span class="token comment">// 发起更新状态：</span>
<span class="token comment">// 参数： action 对象</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'increment'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 相当于： reducer(10, { type: 'increment' })</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'更新后：'</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 11</span>
</code></pre></div><h2 id="解决问题-redux在react中使用"><a href="#解决问题-redux在react中使用" class="header-anchor">#</a> 解决问题-redux在react中使用</h2> <h3 id="目标-5"><a href="#目标-5" class="header-anchor">#</a> 目标</h3> <p>用redux来解决前面提到的多组件数据共享的问题</p> <h3 id="目录结构-2"><a href="#目录结构-2" class="header-anchor">#</a> 目录结构</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>├── src
   ├── store          <span class="token comment"># redux目录，一般约定叫store</span>
   │   ├── index.js   <span class="token comment"># 定义并导出store. 其中会导入reducer</span>
   │   └── reducer    <span class="token comment"># reducer函数</span>
   ├── App.js         <span class="token comment"># 根组件，引入Father 和 Uncle组件</span>
   ├── Father.js      <span class="token comment"># Father组件。其中引入了Son组件</span>
   ├── index.js       <span class="token comment"># 项目的入口文件，会导入并渲染App.js</span>
   ├── Son.js         <span class="token comment"># Son组件</span>
   └── Uncle.js       <span class="token comment"># Unclde组件</span>
</code></pre></div><h3 id="store-index-js"><a href="#store-index-js" class="header-anchor">#</a> store/index.js</h3> <p>index.js</p> <p>用reducer来初始化store</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> reducer <span class="token keyword">from</span> <span class="token string">'./reducer'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>
</code></pre></div><h3 id="reducer-js"><a href="#reducer-js" class="header-anchor">#</a> reducer.js</h3> <p>设置初始值，并提供修改数据的逻辑</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> initState <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">reducer</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> initState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'addN'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> action<span class="token punctuation">.</span>payload
    <span class="token keyword">case</span> <span class="token string">'sub'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="src-index-js"><a href="#src-index-js" class="header-anchor">#</a> src/index.js</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> ReactDom <span class="token keyword">from</span> <span class="token string">'react-dom'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span>

<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store/index.js'</span>
ReactDom<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 数据变化时，重新渲染</span>
store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ReactDom<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>src/App.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> Father <span class="token keyword">from</span> <span class="token string">'./Father'</span>
<span class="token keyword">import</span> Uncle <span class="token keyword">from</span> <span class="token string">'./Uncle'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">border</span><span class="token operator">:</span> <span class="token string">'1px solid #ccc'</span><span class="token punctuation">,</span> <span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
      根组件
      <span class="token operator">&lt;</span>Father <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Uncle <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="son-js"><a href="#son-js" class="header-anchor">#</a> son.js</h3> <p>获取数据:  store.getState()</p> <p>修改数据:  store.dispatch(action)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store/index'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Son</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>n<span class="token punctuation">,</span> setN<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'addN'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> n <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">border</span><span class="token operator">:</span> <span class="token string">'1px solid #ccc'</span><span class="token punctuation">,</span> <span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
      子组件
      <span class="token punctuation">{</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>add<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span>n<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>n<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setN</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="uncle-js"><a href="#uncle-js" class="header-anchor">#</a> uncle.js</h3> <p>修改数据:  store.dispatch(action)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store/index'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Uncle</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">border</span><span class="token operator">:</span> <span class="token string">'1px solid #ccc'</span><span class="token punctuation">,</span> <span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
      Uncle组件
      <span class="token operator">&lt;</span>button
        onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'sub'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">-</span><span class="token number">1</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="react-redux基本介绍"><a href="#react-redux基本介绍" class="header-anchor">#</a> React-redux基本介绍</h2> <h3 id="目标-6"><a href="#目标-6" class="header-anchor">#</a> 目标</h3> <p>能够说出为什么需要使用react-redux</p> <h3 id="react中直接使用redux有很多不方便的地方"><a href="#react中直接使用redux有很多不方便的地方" class="header-anchor">#</a> react中直接使用redux有很多不方便的地方</h3> <ol><li>每个组件都需要单独导入store</li> <li>在根组件上的写法不友好</li></ol> <h3 id="react-redux-库"><a href="#react-redux-库" class="header-anchor">#</a> react-redux 库</h3> <p>是 Redux 官方提供的 React 绑定库</p> <ol><li>React 和 Redux 是两个独立的库，两者之间职责独立。</li> <li>Redux可以和其他的js库，框架一起使用，而并不专门用于react。</li> <li>为了实现在 React 中使用 Redux 进行状态管理 ，就需要一种机制，将这两个独立的库关联在一起。这时候就用到 React-Redux 这个绑定库了</li> <li>作用:  为 React 接入 Redux，实现在 React 中使用 Redux 进行状态管理。</li></ol> <h2 id="react-redux-基本使用"><a href="#react-redux-基本使用" class="header-anchor">#</a> react-redux-基本使用</h2> <h3 id="目标-7"><a href="#目标-7" class="header-anchor">#</a> 目标</h3> <p>使用<a href="https://react-redux.js.org/introduction/getting-started" target="_blank" rel="noopener noreferrer">react-redux<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>简化redux在react项目中的使用</p> <h3 id="步骤"><a href="#步骤" class="header-anchor">#</a> 步骤</h3> <ol><li>安装 <code>npm i react-redux</code></li> <li>使用
<ol><li>按redux的要求，创建好store, reducer,action等等</li> <li>从react-redux中引入 provider, useSelector, useDispatch来 操作 redux</li></ol></li></ol> <h3 id="api"><a href="#api" class="header-anchor">#</a> API</h3> <p>Provider</p> <ul><li>用法：直接包装在根组件上。<code>&lt;Provider store={store}&gt;</code></li> <li>好处：相比react + redux，这样就不需要每个组件都引入store了</li></ul> <p>useSelector</p> <ul><li>用法：获取公共状态</li> <li>好处：
<ul><li>相比react + redux，不需要使用store.getState()了</li> <li>state变化了，它会自动更新</li></ul></li> <li>格式：<code>const 状态 = useSelector(store的数据 =&gt; 你需要的部分)</code></li></ul> <p>useDispatch</p> <ul><li>用法：派发action，修改数据</li> <li>格式： <code>const dispatch = useDispatch(); dispatch(action)</code></li></ul> <h3 id="代码"><a href="#代码" class="header-anchor">#</a> 代码</h3> <p>index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> ReactDom <span class="token keyword">from</span> <span class="token string">'react-dom'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
ReactDom<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

</code></pre></div><p>uncle.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> useDispatch<span class="token punctuation">,</span> useSelector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Uncle</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 修改数据</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// 获取数据</span>
  <span class="token comment">// state:就是 redux中的数据</span>
  <span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> state
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">border</span><span class="token operator">:</span> <span class="token string">'1px solid #ccc'</span><span class="token punctuation">,</span> <span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
      Uncle组件<span class="token punctuation">,</span> <span class="token punctuation">{</span>num<span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>button
        onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'sub1'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">-</span><span class="token number">1</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="reducer-的分离与合并-思路"><a href="#reducer-的分离与合并-思路" class="header-anchor">#</a> Reducer 的分离与合并-思路</h2> <h3 id="问题"><a href="#问题" class="header-anchor">#</a> 问题</h3> <p>随着项目功能变得越来越复杂，需要 Redux 管理的状态也会越来越多。导致reducer函数越来越重。</p> <p>例如，项目要管理<strong>图书</strong>和<strong>个人信息</strong></p> <h3 id="解决思路"><a href="#解决思路" class="header-anchor">#</a> 解决思路</h3> <p>拆分。按业务模块拆分，把大的reducer拆成小文件。</p> <p>示例：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>├── src
   ├── store          <span class="token comment"># redux目录，一般约定叫store</span>
   <span class="token operator">|</span>     ├── index.js   <span class="token comment"># 定义并导出store. 其中会导入reducer</span>
   <span class="token operator">|</span>     └── reducers   <span class="token comment"># 多个模块的reducer</span>
   <span class="token operator">|</span>         ├── reducer1.js   <span class="token comment"># 模块1的reducer</span>
   <span class="token operator">|</span>         ├── reducer2.js   <span class="token comment"># 模块2的reducer</span>
   <span class="token operator">|</span>         └── index.js      <span class="token comment"># reducer的整体入口，会导入reducer1, reducer2</span>
   ├── index.js       <span class="token comment"># 项目的入口文件，会导入并渲染App.js</span>
   ├── App.js         <span class="token comment"># 根组件，引入模块1 和模块2 组件</span>
   ├── 模块1.js       <span class="token comment"># 模块1 组件</span>
   └── 模块2.js       <span class="token comment"># 模块2 组件</span>

</code></pre></div><h3 id="示例代码"><a href="#示例代码" class="header-anchor">#</a> 示例代码</h3> <p>src/store/reducers/book.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">book</span> <span class="token punctuation">(</span>state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'射雕英雄传'</span><span class="token punctuation">,</span> <span class="token string">'天龙八部'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'book/add'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">]</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>src/store/reducers/index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> book <span class="token keyword">from</span> <span class="token string">'./book'</span>
<span class="token keyword">import</span> user <span class="token keyword">from</span> <span class="token string">'./user'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> combineReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>

<span class="token keyword">const</span> rootReducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  book<span class="token punctuation">,</span>
  user
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> rootReducer

</code></pre></div><h2 id="reducer-的分离与合并-实现"><a href="#reducer-的分离与合并-实现" class="header-anchor">#</a> Reducer 的分离与合并-实现</h2> <h3 id="示意图"><a href="#示意图" class="header-anchor">#</a> 示意图</h3> <p><img src="/jiely/assets/img/image-20211113112349218.9a466019.png" alt="image-20211113112349218"></p> <p><strong>合并后，Redux 的状态会变为一个对象，对象的结构与 combineReducers 函数的参数结构相同</strong></p> <h3 id="操作"><a href="#操作" class="header-anchor">#</a> 操作</h3> <ul><li>获取状态。<code>useSelecter</code></li> <li>修改状态。<code>dispatch()</code></li></ul> <h3 id="小结-3"><a href="#小结-3" class="header-anchor">#</a> 小结</h3> <ol><li>多个reducer会合并在一起。</li> <li>每一个action都去执行每个reducer</li> <li>action.type取名时，加上模块名</li></ol> <h2 id="案例-todo-基本介绍"><a href="#案例-todo-基本介绍" class="header-anchor">#</a> 案例-todo-基本介绍</h2> <p>用function组件+hooks + react-redux</p> <p>案例-todo-初始化</p> <ol><li><p>store准备</p> <p><img src="/jiely/assets/img/image-20211113155219383.3171dc7f.png" alt="image-20211113155219383"></p></li> <li><p>组件划分</p></li></ol> <p><img src="/jiely/assets/img/image-20211113155415445.a5ec0416.png" alt="image-20211113155415445"></p> <h2 id="案例-todo-列表渲染"><a href="#案例-todo-列表渲染" class="header-anchor">#</a> 案例-todo-列表渲染</h2> <p>main.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useSelector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> Item <span class="token keyword">from</span> <span class="token string">'./Item'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>todos<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>section className<span class="token operator">=</span><span class="token string">&quot;main&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">&quot;toggle-all&quot;</span> className<span class="token operator">=</span><span class="token string">&quot;toggle-all&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;checkbox&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">&quot;toggle-all&quot;</span><span class="token operator">&gt;</span>Mark all <span class="token keyword">as</span> complete<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>ul className<span class="token operator">=</span><span class="token string">&quot;todo-list&quot;</span><span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">it</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>Item key<span class="token operator">=</span><span class="token punctuation">{</span>it<span class="token punctuation">.</span>id<span class="token punctuation">}</span> todo<span class="token operator">=</span><span class="token punctuation">{</span>it<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>item.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* eslint-disable react/prop-types */</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Item</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> todo <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span>id<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span>isDone <span class="token operator">?</span> <span class="token string">'completed'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;view&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input className<span class="token operator">=</span><span class="token string">&quot;toggle&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;checkbox&quot;</span> checked<span class="token operator">=</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span>isDone<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>label<span class="token operator">&gt;</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button className<span class="token operator">=</span><span class="token string">&quot;destroy&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input
        className<span class="token operator">=</span><span class="token string">&quot;edit&quot;</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
        value<span class="token operator">=</span><span class="token string">&quot;Create a TodoMVC template&quot;</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="案例-todo-删除任务"><a href="#案例-todo-删除任务" class="header-anchor">#</a> 案例-todo-删除任务</h2> <p>item.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* eslint-disable react/prop-types */</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token operator">+</span> <span class="token keyword">import</span> <span class="token punctuation">{</span> useDispatch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Item</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> todo <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span>id<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span>isDone <span class="token operator">?</span> <span class="token string">'completed'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;view&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input className<span class="token operator">=</span><span class="token string">&quot;toggle&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;checkbox&quot;</span> checked<span class="token operator">=</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span>isDone<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>label<span class="token operator">&gt;</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button
          className<span class="token operator">=</span><span class="token string">&quot;destroy&quot;</span>
<span class="token operator">+</span>          onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'todos/del'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> todo<span class="token punctuation">.</span>id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input
        className<span class="token operator">=</span><span class="token string">&quot;edit&quot;</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
        value<span class="token operator">=</span><span class="token string">&quot;Create a TodoMVC template&quot;</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>reducer/todos.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> initState <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'吃饭'</span><span class="token punctuation">,</span> <span class="token literal-property property">isDone</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'睡觉'</span><span class="token punctuation">,</span> <span class="token literal-property property">isDone</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token keyword">function</span> <span class="token function">todos</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> initState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'todos/add'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">,</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">]</span>
    <span class="token keyword">case</span> <span class="token string">'todos/del'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">it</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> it<span class="token punctuation">.</span>id <span class="token operator">!==</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> todos

</code></pre></div><h2 id="案例-todo-修改任务状态"><a href="#案例-todo-修改任务状态" class="header-anchor">#</a> 案例-todo-修改任务状态</h2> <p>reducer</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">todos</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> initState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'todos/add'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">,</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">]</span>
    <span class="token keyword">case</span> <span class="token string">'todos/del'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">it</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> it<span class="token punctuation">.</span>id <span class="token operator">!==</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token string">'todos/changeState'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token parameter">it</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
          it<span class="token punctuation">.</span>id <span class="token operator">===</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>id
            <span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token operator">...</span>it<span class="token punctuation">,</span> <span class="token literal-property property">isDone</span><span class="token operator">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>isDone <span class="token punctuation">}</span>
            <span class="token operator">:</span> it
      <span class="token punctuation">)</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>item.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>input
  className<span class="token operator">=</span><span class="token string">&quot;toggle&quot;</span>
  onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'todos/changeState'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> todo<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token literal-property property">isDone</span><span class="token operator">:</span> <span class="token operator">!</span>todo<span class="token punctuation">.</span>isDone <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">}</span>
  type<span class="token operator">=</span><span class="token string">&quot;checkbox&quot;</span>
  checked<span class="token operator">=</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span>isDone<span class="token punctuation">}</span>
<span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><h2 id="案例-todo-添加新任务"><a href="#案例-todo-添加新任务" class="header-anchor">#</a> 案例-todo-添加新任务</h2> <p>header.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useDispatch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Header</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>header className<span class="token operator">=</span><span class="token string">&quot;header&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>todos<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input
        onKeyUp<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>keyCode <span class="token operator">===</span> <span class="token number">13</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>name<span class="token punctuation">)</span> <span class="token keyword">return</span>
            <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'todos/add'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
        className<span class="token operator">=</span><span class="token string">&quot;new-todo&quot;</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">setName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
        placeholder<span class="token operator">=</span><span class="token string">&quot;接下来打算做点啥?&quot;</span>
        autoFocus
      <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>header<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>reducer/todos.js</p> <p>补充：'todos/add'</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> initState <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'吃饭'</span><span class="token punctuation">,</span> <span class="token literal-property property">isDone</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'睡觉'</span><span class="token punctuation">,</span> <span class="token literal-property property">isDone</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token keyword">let</span> idx <span class="token operator">=</span> <span class="token number">2</span>
<span class="token keyword">function</span> <span class="token function">todos</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> initState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'todos/add'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token operator">++</span>idx<span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">,</span> <span class="token literal-property property">isDone</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token keyword">case</span> <span class="token string">'todos/del'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">it</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> it<span class="token punctuation">.</span>id <span class="token operator">!==</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token string">'todos/changeState'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token parameter">it</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
          it<span class="token punctuation">.</span>id <span class="token operator">===</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>id
            <span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token operator">...</span>it<span class="token punctuation">,</span> <span class="token literal-property property">isDone</span><span class="token operator">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>isDone <span class="token punctuation">}</span>
            <span class="token operator">:</span> it
      <span class="token punctuation">)</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> todos

</code></pre></div><h2 id="案例-todo-全选功能"><a href="#案例-todo-全选功能" class="header-anchor">#</a> 案例-todo- 全选功能</h2> <p>main.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>todos<span class="token punctuation">)</span>
<span class="token operator">+</span> <span class="token keyword">const</span> isCheckAll <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">it</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> it<span class="token punctuation">.</span>isDone<span class="token punctuation">)</span>
<span class="token operator">+</span> <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>section className<span class="token operator">=</span><span class="token string">&quot;main&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input
        id<span class="token operator">=</span><span class="token string">&quot;toggle-all&quot;</span>
        className<span class="token operator">=</span><span class="token string">&quot;toggle-all&quot;</span>
<span class="token operator">+</span>        checked<span class="token operator">=</span><span class="token punctuation">{</span>isCheckAll<span class="token punctuation">}</span>
<span class="token operator">+</span>        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'todos/changeAll'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token operator">!</span>isCheckAll <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
        type<span class="token operator">=</span><span class="token string">&quot;checkbox&quot;</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>

</code></pre></div><p>reducer/todos.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">case</span> <span class="token string">'todos/changeAll'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">it</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>it<span class="token punctuation">,</span> <span class="token literal-property property">isDone</span><span class="token operator">:</span> action<span class="token punctuation">.</span>payload <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="案例-todo-双击-开启编辑"><a href="#案例-todo-双击-开启编辑" class="header-anchor">#</a> 案例-todo-双击-开启编辑</h2> <p>背景：编辑时有一个特殊的类 editing</p> <p>Item.js</p> <ul><li>双击进入编辑模式</li> <li>失去焦点，放弃编辑</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* eslint-disable react/prop-types */</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useDispatch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Item</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> todo <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isEdit<span class="token punctuation">,</span> setIsEdit<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>todo<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
  <span class="token keyword">const</span> classes <span class="token operator">=</span> <span class="token punctuation">[</span>todo<span class="token punctuation">.</span>isDone <span class="token operator">?</span> <span class="token string">'completed'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> isEdit <span class="token operator">?</span> <span class="token string">'editing'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">]</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span>id<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token punctuation">{</span>classes<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;view&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input
          className<span class="token operator">=</span><span class="token string">&quot;toggle&quot;</span>
          onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'todos/changeState'</span><span class="token punctuation">,</span>
              <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> todo<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token literal-property property">isDone</span><span class="token operator">:</span> <span class="token operator">!</span>todo<span class="token punctuation">.</span>isDone <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span>
          type<span class="token operator">=</span><span class="token string">&quot;checkbox&quot;</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span>isDone<span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>label
          onDoubleClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">setIsEdit</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
          <span class="token punctuation">{</span>todo<span class="token punctuation">.</span>name<span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button
          className<span class="token operator">=</span><span class="token string">&quot;destroy&quot;</span>
          onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'todos/del'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> todo<span class="token punctuation">.</span>id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input
        onBlur<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setIsEdit</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        className<span class="token operator">=</span><span class="token string">&quot;edit&quot;</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">setName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="案例-todo-双击-保存修改"><a href="#案例-todo-双击-保存修改" class="header-anchor">#</a> 案例-todo-双击-保存修改</h2> <p>main.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>input
        onKeyUp<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>keyCode <span class="token operator">===</span> <span class="token number">13</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'todos/editName'</span><span class="token punctuation">,</span>
              <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> todo<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token literal-property property">newName</span><span class="token operator">:</span> name <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
        onBlur<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setIsEdit</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        className<span class="token operator">=</span><span class="token string">&quot;edit&quot;</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">setName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><p>reducer/todos.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">case</span> <span class="token string">'todos/changeName'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token parameter">it</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span>id <span class="token operator">===</span> payload<span class="token punctuation">.</span>id <span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token operator">...</span>it<span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> payload<span class="token punctuation">.</span>newName <span class="token punctuation">}</span> <span class="token operator">:</span> it<span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
</code></pre></div><p>1</p> <h2 id="案例-todo-双击-自动获取焦点-问题"><a href="#案例-todo-双击-自动获取焦点-问题" class="header-anchor">#</a> 案例-todo-双击-自动获取焦点-问题</h2> <p>item.js</p> <p>用副作用函数来获取焦点</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> refTxt <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      refTxt<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>isEdit<span class="token punctuation">]</span>
  <span class="token punctuation">)</span>

<span class="token operator">&lt;</span>input
        onKeyUp<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>keyCode <span class="token operator">===</span> <span class="token number">13</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'todos/editName'</span><span class="token punctuation">,</span>
              <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> todo<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token literal-property property">newName</span><span class="token operator">:</span> name <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
        ref<span class="token operator">=</span><span class="token punctuation">{</span>refTxt<span class="token punctuation">}</span>
        onBlur<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setIsEdit</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        className<span class="token operator">=</span><span class="token string">&quot;edit&quot;</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">setName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><h2 id="案例-todo-清空已完成任务"><a href="#案例-todo-清空已完成任务" class="header-anchor">#</a> 案例-todo-清空已完成任务</h2> <p>Footer.js</p> <p>思路： <code>dispatch({ type: 'todos/delDone' })</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> useSelector<span class="token punctuation">,</span> useDispatch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Footer</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>todos<span class="token punctuation">)</span>
  <span class="token keyword">const</span> countOfUnDone <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">it</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>it<span class="token punctuation">.</span>isDone<span class="token punctuation">)</span><span class="token punctuation">.</span>length
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>footer className<span class="token operator">=</span><span class="token string">&quot;footer&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>span className<span class="token operator">=</span><span class="token string">&quot;todo-count&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>strong<span class="token operator">&gt;</span><span class="token punctuation">{</span>countOfUnDone<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>strong<span class="token operator">&gt;</span> 未完成
      <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>ul className<span class="token operator">=</span><span class="token string">&quot;filters&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>a className<span class="token operator">=</span><span class="token string">&quot;selected&quot;</span> href<span class="token operator">=</span><span class="token string">&quot;#/&quot;</span><span class="token operator">&gt;</span>
            所有
          <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;#/active&quot;</span><span class="token operator">&gt;</span>待办<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;#/completed&quot;</span><span class="token operator">&gt;</span>已完成<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button
        className<span class="token operator">=</span><span class="token string">&quot;clear-completed&quot;</span>
        onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>          <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'todos/delDone'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
        清空已完成
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>footer<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>reducer/todos.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">case</span> <span class="token string">'todos/delDone'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">it</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>it<span class="token punctuation">.</span>isDone<span class="token punctuation">)</span>
</code></pre></div><h2 id="案例-todo-底部筛选"><a href="#案例-todo-底部筛选" class="header-anchor">#</a> 案例-todo-底部筛选</h2> <p>footer.js</p> <ol><li>点击不同类型时去修改redux中的state</li> <li>根据当前的state来显示是否选中</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> useSelector<span class="token punctuation">,</span> useDispatch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Footer</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>todos<span class="token punctuation">)</span>
  <span class="token keyword">const</span> filterType <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>filter<span class="token punctuation">)</span>
  <span class="token keyword">const</span> countOfUnDone <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">it</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>it<span class="token punctuation">.</span>isDone<span class="token punctuation">)</span><span class="token punctuation">.</span>length
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>footer className<span class="token operator">=</span><span class="token string">&quot;footer&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>span className<span class="token operator">=</span><span class="token string">&quot;todo-count&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>strong<span class="token operator">&gt;</span><span class="token punctuation">{</span>countOfUnDone<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>strong<span class="token operator">&gt;</span> 未完成
      <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>ul className<span class="token operator">=</span><span class="token string">&quot;filters&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>a
            className<span class="token operator">=</span><span class="token punctuation">{</span>filterType <span class="token operator">===</span> <span class="token string">'all'</span> <span class="token operator">?</span> <span class="token string">'selected'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">}</span>
            href<span class="token operator">=</span><span class="token string">&quot;#/&quot;</span>
            onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
              <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'filter/setType'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token string">'all'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
            <span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
            所有
          <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>a
            className<span class="token operator">=</span><span class="token punctuation">{</span>filterType <span class="token operator">===</span> <span class="token string">'active'</span> <span class="token operator">?</span> <span class="token string">'selected'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">}</span>
            href<span class="token operator">=</span><span class="token string">&quot;#/active&quot;</span>
            onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
              <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'filter/setType'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token string">'active'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
            待办
          <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>a
            className<span class="token operator">=</span><span class="token punctuation">{</span>filterType <span class="token operator">===</span> <span class="token string">'completed'</span> <span class="token operator">?</span> <span class="token string">'selected'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">}</span>
            href<span class="token operator">=</span><span class="token string">&quot;#/completed&quot;</span>
            onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
              <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'filter/setType'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token string">'completed'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
            已完成
          <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button
        className<span class="token operator">=</span><span class="token string">&quot;clear-completed&quot;</span>
        onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'todos/delDone'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
        清空已完成
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>footer<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>reducer/filter.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">filter</span> <span class="token punctuation">(</span>state <span class="token operator">=</span> <span class="token string">'all'</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'filter/setType'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> action<span class="token punctuation">.</span>payload
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>main.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>filter <span class="token operator">===</span> <span class="token string">'all'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span>todos
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>filter <span class="token operator">===</span> <span class="token string">'active'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">it</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>it<span class="token punctuation">.</span>isDone<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">it</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> it<span class="token punctuation">.</span>isDone<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="拓展-纯函数"><a href="#拓展-纯函数" class="header-anchor">#</a> 拓展-纯函数</h2> <p>**目标：**了解纯函数的特点</p> <p><strong>内容：</strong></p> <ul><li><p>纯函数是<em>函数式编程</em>中的概念，对于纯函数来说，<strong>相同的输入总是得到相同的输出</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span>
arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>

arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>原则：</p> <ul><li>不得改写参数</li> <li>不能调用 Date.now()或者 Math.random()等不纯的方法，因为每次会得到不一样的结果</li> <li>不能使用全局变量</li></ul></li> <li><p><strong>reducer 必须是一个纯函数</strong></p></li> <li><p>纯函数主要的含义就是它不可以修改影响输入值</p></li> <li><p>没有副作用，副作用指的是例如函数中一些异步调用或者会影响函数作用域之外的变量一类的操作</p></li></ul> <p>纯函数的好处：</p> <ol><li>效率高，可以使用缓存来优化</li></ol> <h2 id="拓展-在原生js中使用redux"><a href="#拓展-在原生js中使用redux" class="header-anchor">#</a> 拓展-在原生js中使用redux</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">&quot;X-UA-Compatible&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;IE=edge&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">&quot;viewport&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Document<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token literal-property property">数据</span><span class="token operator">:</span> <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;res&quot;</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>button<span class="token operator">&gt;</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>button onclick<span class="token operator">=</span><span class="token string">&quot;store.dispatch({type:'sub',data:1})&quot;</span><span class="token operator">&gt;</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./redux.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;https://cdn.bootcdn.net/ajax/libs/redux/4.1.0/redux.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'add'</span><span class="token punctuation">}</span>
        <span class="token keyword">const</span> <span class="token function-variable function">actionCreater</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'add'</span><span class="token punctuation">,</span>
            data
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> <span class="token function-variable function">reduer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token string">&quot;add&quot;</span><span class="token operator">:</span>
                    <span class="token keyword">return</span> state <span class="token operator">+</span> action<span class="token punctuation">.</span>data
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">&quot;sub&quot;</span><span class="token operator">:</span>
                    <span class="token keyword">return</span> state <span class="token operator">+</span> action<span class="token punctuation">.</span>data
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            
                <span class="token keyword">default</span><span class="token operator">:</span>
                    <span class="token keyword">return</span> state
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//   创建store</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token operator">=</span> Redux
        <span class="token comment">//   createStore(reducer函数,可选=&gt;state初始值)</span>
        <span class="token keyword">let</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reduer<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
        <span class="token comment">// 打印初始状态</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// {count: 1}</span>
        <span class="token comment">// 每次 state 更新时，打印日志</span>
        <span class="token comment">// 注意 subscribe() 返回一个函数用来注销监听器</span>
        <span class="token keyword">const</span> unsubscribe <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#res'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token comment">// 发起一系列 action</span>
        store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">actionCreater</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">// store.dispatch(add(4))</span>
        <span class="token comment">// 停止监听 state 更新</span>
        <span class="token comment">// unsubscribe();</span>


    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/jiely/chapter1/06-react-hooks进阶.html" class="prev">
        React Hooks进阶
      </a></span> <span class="next"><a href="/jiely/chapter1/08-redux进阶.html">
        Redux 中间件
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/jiely/assets/js/app.87156db4.js" defer></script><script src="/jiely/assets/js/3.05e47443.js" defer></script><script src="/jiely/assets/js/13.46042c4c.js" defer></script>
  </body>
</html>
