<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>发布文章-基本结构 | react 快速上手</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="shortcut icon" type="image/x-icon" href="./images/favicon.ico">
    <meta name="description" content="杰哥哥前端研究院">
    
    <link rel="preload" href="/jiely/assets/css/0.styles.5afc0e25.css" as="style"><link rel="preload" href="/jiely/assets/js/app.87156db4.js" as="script"><link rel="preload" href="/jiely/assets/js/3.05e47443.js" as="script"><link rel="preload" href="/jiely/assets/js/30.117590fb.js" as="script"><link rel="prefetch" href="/jiely/assets/js/10.1bb09252.js"><link rel="prefetch" href="/jiely/assets/js/11.7487ab28.js"><link rel="prefetch" href="/jiely/assets/js/12.a9e0b5c6.js"><link rel="prefetch" href="/jiely/assets/js/13.46042c4c.js"><link rel="prefetch" href="/jiely/assets/js/14.7e9485d0.js"><link rel="prefetch" href="/jiely/assets/js/15.82bd5665.js"><link rel="prefetch" href="/jiely/assets/js/16.da48c8d1.js"><link rel="prefetch" href="/jiely/assets/js/17.4c4fbca4.js"><link rel="prefetch" href="/jiely/assets/js/18.8f64b26e.js"><link rel="prefetch" href="/jiely/assets/js/19.6e619bb0.js"><link rel="prefetch" href="/jiely/assets/js/2.af879dde.js"><link rel="prefetch" href="/jiely/assets/js/20.a8659479.js"><link rel="prefetch" href="/jiely/assets/js/21.c50358c3.js"><link rel="prefetch" href="/jiely/assets/js/22.2b3cb2cc.js"><link rel="prefetch" href="/jiely/assets/js/23.ef2a71c6.js"><link rel="prefetch" href="/jiely/assets/js/24.713e58c4.js"><link rel="prefetch" href="/jiely/assets/js/25.9e2de17e.js"><link rel="prefetch" href="/jiely/assets/js/26.ebe2c2c7.js"><link rel="prefetch" href="/jiely/assets/js/27.b410c517.js"><link rel="prefetch" href="/jiely/assets/js/28.416e0f83.js"><link rel="prefetch" href="/jiely/assets/js/29.28bb402e.js"><link rel="prefetch" href="/jiely/assets/js/31.012589f4.js"><link rel="prefetch" href="/jiely/assets/js/32.391074f7.js"><link rel="prefetch" href="/jiely/assets/js/33.3b5bff31.js"><link rel="prefetch" href="/jiely/assets/js/34.5f03808f.js"><link rel="prefetch" href="/jiely/assets/js/35.c836f09c.js"><link rel="prefetch" href="/jiely/assets/js/36.cdfd4095.js"><link rel="prefetch" href="/jiely/assets/js/37.3888e0de.js"><link rel="prefetch" href="/jiely/assets/js/38.9d42564b.js"><link rel="prefetch" href="/jiely/assets/js/39.af6cc2f1.js"><link rel="prefetch" href="/jiely/assets/js/4.cb17c8a3.js"><link rel="prefetch" href="/jiely/assets/js/40.28ea6c30.js"><link rel="prefetch" href="/jiely/assets/js/41.07ff3483.js"><link rel="prefetch" href="/jiely/assets/js/42.461144bb.js"><link rel="prefetch" href="/jiely/assets/js/43.7381291e.js"><link rel="prefetch" href="/jiely/assets/js/44.e99c69d5.js"><link rel="prefetch" href="/jiely/assets/js/45.82ace09a.js"><link rel="prefetch" href="/jiely/assets/js/46.6f99a05f.js"><link rel="prefetch" href="/jiely/assets/js/47.50c29aca.js"><link rel="prefetch" href="/jiely/assets/js/48.8de86252.js"><link rel="prefetch" href="/jiely/assets/js/49.7b800d70.js"><link rel="prefetch" href="/jiely/assets/js/5.8ae26c23.js"><link rel="prefetch" href="/jiely/assets/js/6.9b2d155f.js"><link rel="prefetch" href="/jiely/assets/js/7.276458e1.js"><link rel="prefetch" href="/jiely/assets/js/8.b230375e.js"><link rel="prefetch" href="/jiely/assets/js/9.fae1b1d4.js">
    <link rel="stylesheet" href="/jiely/assets/css/0.styles.5afc0e25.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/jiely/" class="home-link router-link-active"><img src="/jiely/images/logo.jpg" alt="react 快速上手" class="logo"> <span class="site-name can-hide">react 快速上手</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://juejin.cn/post/7097067108663558151" target="_blank" rel="noopener noreferrer" class="nav-link external">
  50+Vue经典面试题源码级
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://segmentfault.com/a/1190000018604138" target="_blank" rel="noopener noreferrer" class="nav-link external">
  react面试题
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://juejin.cn/post/6844904055840440334" target="_blank" rel="noopener noreferrer" class="nav-link external">
  从零React项目
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://summerjie007.github.io/vue3_study/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue3+TS
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/airbnb/javascript" target="_blank" rel="noopener noreferrer" class="nav-link external">
  代码规范
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://juejin.cn/post/7097067108663558151" target="_blank" rel="noopener noreferrer" class="nav-link external">
  50+Vue经典面试题源码级
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://segmentfault.com/a/1190000018604138" target="_blank" rel="noopener noreferrer" class="nav-link external">
  react面试题
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://juejin.cn/post/6844904055840440334" target="_blank" rel="noopener noreferrer" class="nav-link external">
  从零React项目
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://summerjie007.github.io/vue3_study/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue3+TS
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/airbnb/javascript" target="_blank" rel="noopener noreferrer" class="nav-link external">
  代码规范
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/jiely/00_课程介绍.html" class="sidebar-link">课程指南</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>一.react全家桶上手</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>二.react全家桶项目</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>01-项目搭建</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>02-登录功能</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>03-首页</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>04-文章列表</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>05-发布与编辑文章</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jiely/chapter3/05-发布与编辑文章.html" class="active sidebar-link">发布文章-基本结构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jiely/chapter3/05-发布与编辑文章.html#发布文章-基本结构" class="sidebar-link">发布文章-基本结构</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter3/05-发布与编辑文章.html#频道数据获取-自定义hooks封装" class="sidebar-link">频道数据获取-自定义hooks封装</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter3/05-发布与编辑文章.html#频道优化-自定义组件" class="sidebar-link">频道优化-自定义组件</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter3/05-发布与编辑文章.html#发布文章-富文本编辑器" class="sidebar-link">发布文章-富文本编辑器</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter3/05-发布与编辑文章.html#封面处理-上传组件的基本使用" class="sidebar-link">封面处理-上传组件的基本使用</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter3/05-发布与编辑文章.html#发布文章-上传封面" class="sidebar-link">发布文章-上传封面</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter3/05-发布与编辑文章.html#发布文章-控制封面数量" class="sidebar-link">发布文章-控制封面数量</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter3/05-发布与编辑文章.html#发布文章-动态切换封面数量" class="sidebar-link">发布文章-动态切换封面数量</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter3/05-发布与编辑文章.html#发布文章-表单的校验" class="sidebar-link">发布文章-表单的校验</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter3/05-发布与编辑文章.html#表单校验-封面类型-优化" class="sidebar-link">表单校验-封面类型-优化</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter3/05-发布与编辑文章.html#发布文章-组装表单提交数据" class="sidebar-link">发布文章-组装表单提交数据</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter3/05-发布与编辑文章.html#发布文章-提交数据-完成发布" class="sidebar-link">发布文章-提交数据-完成发布</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter3/05-发布与编辑文章.html#发布文章-存入草稿" class="sidebar-link">发布文章-存入草稿</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter3/05-发布与编辑文章.html#编辑文章-展示编辑文章文案" class="sidebar-link">编辑文章-展示编辑文章文案</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter3/05-发布与编辑文章.html#编辑文章-填充文章数据" class="sidebar-link">编辑文章-填充文章数据</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter3/05-发布与编辑文章.html#编辑文章-编辑或存入草稿" class="sidebar-link">编辑文章-编辑或存入草稿</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter3/05-发布与编辑文章.html#发布文章菜单高亮处理" class="sidebar-link">发布文章菜单高亮处理</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter3/05-发布与编辑文章.html#发布文章-编辑文章切换" class="sidebar-link">发布文章-编辑文章切换</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter3/05-发布与编辑文章.html#拓展-发布文章-图片预览功能" class="sidebar-link">拓展-发布文章-图片预览功能</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>06-打包优化</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>三.前端算法之道</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>四.JS设计设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>五.JS报错总结</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>六.Vue3+Pinia</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>七.node.js</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="发布文章-基本结构"><a href="#发布文章-基本结构" class="header-anchor">#</a> 发布文章-基本结构</h2> <p><img src="/jiely/assets/img/image-fabu.10e90674.png" alt="发布文章"></p> <h3 id="目标"><a href="#目标" class="header-anchor">#</a> 目标</h3> <p>能够搭建发布文章页面的基本结构</p> <h3 id="步骤"><a href="#步骤" class="header-anchor">#</a> 步骤</h3> <ol><li>使用 Card、Form 组件搭建基本页面结构</li> <li>创建样式文件，对样式做调整</li></ol> <h3 id="核心代码"><a href="#核心代码" class="header-anchor">#</a> 核心代码</h3> <p>pages/Publish/index.js 中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">'./index.module.scss'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Card<span class="token punctuation">,</span> Breadcrumb<span class="token punctuation">,</span> Form<span class="token punctuation">,</span> Input<span class="token punctuation">,</span> Select<span class="token punctuation">,</span> Button<span class="token punctuation">,</span> Space <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Link <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useSelector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useDispatch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getChannelList <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/store/actions/article'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Publish</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> channels <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>article<span class="token punctuation">.</span>channels<span class="token punctuation">)</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">getChannelList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>dispatch<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>root<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Card
        title<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&lt;</span>Breadcrumb separator<span class="token operator">=</span><span class="token string">&quot;&gt;&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Breadcrumb<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/home&quot;</span><span class="token operator">&gt;</span>首页<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>Breadcrumb<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Breadcrumb<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span>发布文章<span class="token operator">&lt;</span><span class="token operator">/</span>Breadcrumb<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>Breadcrumb<span class="token operator">&gt;</span>
        <span class="token punctuation">}</span>
      <span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Form labelCol<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">span</span><span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> wrapperCol<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">span</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> size<span class="token operator">=</span><span class="token string">&quot;large&quot;</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item label<span class="token operator">=</span><span class="token string">&quot;标题&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Input
              placeholder<span class="token operator">=</span><span class="token string">&quot;请输入文章的标题&quot;</span>
              style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">400</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Input<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item label<span class="token operator">=</span><span class="token string">&quot;频道&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Select style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">200</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> allowClear placeholder<span class="token operator">=</span><span class="token string">&quot;请选择频道&quot;</span><span class="token operator">&gt;</span>
              <span class="token punctuation">{</span>channels<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
                <span class="token operator">&lt;</span>Select<span class="token punctuation">.</span>Option value<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span> key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&gt;</span>
                  <span class="token punctuation">{</span>item<span class="token punctuation">.</span>name<span class="token punctuation">}</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>Select<span class="token punctuation">.</span>Option<span class="token operator">&gt;</span>
              <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>Select<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item label<span class="token operator">=</span><span class="token string">&quot;封面&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Radio<span class="token punctuation">.</span>Group onChange<span class="token operator">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span> value<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>Radio value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token constant">A</span><span class="token operator">&lt;</span><span class="token operator">/</span>Radio<span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>Radio value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token constant">B</span><span class="token operator">&lt;</span><span class="token operator">/</span>Radio<span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>Radio value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token constant">C</span><span class="token operator">&lt;</span><span class="token operator">/</span>Radio<span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>Radio value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token constant">D</span><span class="token operator">&lt;</span><span class="token operator">/</span>Radio<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>Radio<span class="token punctuation">.</span>Group<span class="token operator">&gt;</span>
					<span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span>

          <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item label<span class="token operator">=</span><span class="token string">&quot;内容&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item wrapperCol<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">offset</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token literal-property property">span</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Space<span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">&quot;primary&quot;</span><span class="token operator">&gt;</span>发布文章<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>Button<span class="token operator">&gt;</span>存入草稿<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>Space<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Card<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="频道数据获取-自定义hooks封装"><a href="#频道数据获取-自定义hooks封装" class="header-anchor">#</a> 频道数据获取-自定义hooks封装</h2> <ul><li>新建文件<code>src/hooks/index.js</code></li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> getChannelList <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/store/actions/article'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useDispatch<span class="token punctuation">,</span> useSelector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>

<span class="token comment">/**
 * 获取频道列表
 * @returns 频道列表
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useChannels</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> channels <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>article<span class="token punctuation">.</span>channels<span class="token punctuation">)</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">getChannelList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>dispatch<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> channels
<span class="token punctuation">}</span>

</code></pre></div><ul><li>在组件，直接通过自定义hooks获取频道数据</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useChannels <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/hooks'</span>

<span class="token keyword">const</span> channels <span class="token operator">=</span> <span class="token function">useChannels</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="频道优化-自定义组件"><a href="#频道优化-自定义组件" class="header-anchor">#</a> 频道优化-自定义组件</h2> <h3 id="目标-2"><a href="#目标-2" class="header-anchor">#</a> 目标</h3> <p>定义一个组件来提炼频道组件的功能，以供复用。</p> <h3 id="思路"><a href="#思路" class="header-anchor">#</a> 思路</h3> <p>将频道相关的数据+jsx全部提出来，封装函数式组件。</p> <h3 id="创建组件"><a href="#创建组件" class="header-anchor">#</a> 创建组件</h3> <p><code>src/components/Channel.js</code></p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getChannelList <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/store/actions/channel'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useDispatch<span class="token punctuation">,</span> useSelector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Select <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> channels <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>channel<span class="token punctuation">)</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">getChannelList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>dispatch<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Select</span></span>
      <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">200</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
      <span class="token attr-name">allowClear</span>
      <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>请选择频道<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>channels<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Select.Option</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Select.Option</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Select</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="使用组件"><a href="#使用组件" class="header-anchor">#</a> 使用组件</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item label<span class="token operator">=</span><span class="token string">&quot;频道&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;channel_id&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Channel <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span>
</code></pre></div><h3 id="问题"><a href="#问题" class="header-anchor">#</a> 问题</h3> <p>自定义的组件Channel和Form.Item之间没有任何关联： 表单的初始值，不能传进去； 用户在Channel中的选择项也不能传给Form表单。</p> <p>如何解决？ <a href="https://ant.design/components/form-cn/#components-form-demo-customized-form-controls" target="_blank" rel="noopener noreferrer">文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item label<span class="token operator">=</span><span class="token string">&quot;频道&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;channel_id&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>组件 <span class="token operator">/</span><span class="token operator">&gt;</span>  
    <span class="token punctuation">{</span><span class="token comment">/*如果组件被包在Form.Item中，则，Form.item会自动传入 受控属性value和 onChange事件。
    在组件内部使用 value和onChange 完成受控动作*/</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span>
</code></pre></div><p>测试一下，在Channel中通过props来接收一下， 并打印结果。</p> <h3 id="解决"><a href="#解决" class="header-anchor">#</a> 解决</h3> <p>从Form.Item上接收到的props直接传递给Select组件即可。</p> <h2 id="发布文章-富文本编辑器"><a href="#发布文章-富文本编辑器" class="header-anchor">#</a> 发布文章-富文本编辑器</h2> <h3 id="目标-3"><a href="#目标-3" class="header-anchor">#</a> 目标</h3> <p>能够使用富文本编辑器</p> <h3 id="步骤-2"><a href="#步骤-2" class="header-anchor">#</a> 步骤</h3> <ol><li>安装富文本编辑器：<code>npm i react-quill</code></li> <li>导入富文本编辑器组件以及样式文件</li> <li>渲染富文本编辑器组件</li> <li>通过 Form 组件的 initialValues 为富文本编辑器设置初始值，<strong>否则会报错</strong></li> <li>调整富文本编辑器的样式</li></ol> <h3 id="核心代码-2"><a href="#核心代码-2" class="header-anchor">#</a> <strong>核心代码</strong>：</h3> <p>pages/Publish/Publish.jsx 中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> ReactQuill <span class="token keyword">from</span> <span class="token string">'react-quill'</span>
<span class="token keyword">import</span> <span class="token string">'react-quill/dist/quill.snow.css'</span>

<span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item label<span class="token operator">=</span><span class="token string">&quot;内容&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;content&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>ReactQuill<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>ReactQuill<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span>
</code></pre></div><p>补充样式：pages/Publish/index.module.scss</p> <div class="language-scss extra-class"><pre class="language-scss"><code><span class="token selector">.root </span><span class="token punctuation">{</span>
  <span class="token selector">:global </span><span class="token punctuation">{</span>
    <span class="token selector">.ql-editor </span><span class="token punctuation">{</span>
      <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="asset/image-20211119154330163.png" alt="image-20211119154330163"></p> <h3 id="注意"><a href="#注意" class="header-anchor">#</a> 注意</h3> <p>要给Form设置initialValues属性，不然富文本组件会报错</p> <h3 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h3> <p>react的富文本编辑器react-quill</p> <h2 id="封面处理-上传组件的基本使用"><a href="#封面处理-上传组件的基本使用" class="header-anchor">#</a> 封面处理-上传组件的基本使用</h2> <h3 id="目标-4"><a href="#目标-4" class="header-anchor">#</a> 目标</h3> <p>学习Upload组件的基本使用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item wrapperCol<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">offset</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token literal-property property">span</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
  <span class="token punctuation">{</span><span class="token comment">/* 
    action: 上传的地址
    name: 上传的文件的名字 默认file
    fileList: 控制上传的图片,做回填 */</span><span class="token punctuation">}</span>
  <span class="token operator">&lt;</span>Upload listType<span class="token operator">=</span><span class="token string">&quot;picture-card&quot;</span> fileList<span class="token operator">=</span><span class="token punctuation">{</span>fileList<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>PlusOutlined <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Upload<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span>


<span class="token keyword">const</span> <span class="token punctuation">[</span>fileList<span class="token punctuation">,</span> setFileList<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre></div><p>fileList的值会回填到上传组件</p> <h3 id="小结-2"><a href="#小结-2" class="header-anchor">#</a> 小结</h3> <p>form.item的数据可以自行收集，但是，Upload组件中的数据，Form表单不会自动收集，需要我们自行处理。</p> <h2 id="发布文章-上传封面"><a href="#发布文章-上传封面" class="header-anchor">#</a> 发布文章-上传封面</h2> <h3 id="目标-5"><a href="#目标-5" class="header-anchor">#</a> 目标</h3> <p>能够实现上传封面图片</p> <h3 id="步骤-3"><a href="#步骤-3" class="header-anchor">#</a> 步骤</h3> <ol><li>为 Upload 组件添加 <strong>action</strong> 属性和<strong>name</strong>，指定封面图片上传接口地址和参数名</li> <li>创建状态 fileList 存储已上传封面图片地址，并设置为 Upload 组件的 fileList 属性值</li> <li>为 Upload 添加 onChange 属性，监听封面图片上传、删除等操作</li> <li>在 change 事件中拿到当前图片数据，并存储到状态 fileList 中</li></ol> <p><strong>核心代码</strong>：</p> <p>pages/Punlish/index.js 中：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token punctuation">{</span><span class="token comment">/* 
  fileList: 控制上传的图片
  action: 上传的地址
  name: 上传的文件的名字 默认file
*/</span><span class="token punctuation">}</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Upload</span></span>
  <span class="token attr-name">listType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>picture-card<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">fileList</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>fileList<span class="token punctuation">}</span></span>
  <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>image<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">action</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">基地址+upload</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span></span>
  <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span></span>
<span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">PlusOutlined</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Upload</span></span><span class="token punctuation">&gt;</span></span>


<span class="token keyword">const</span> <span class="token function-variable function">onChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> fileList <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setFileList</span><span class="token punctuation">(</span>fileList<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="发布文章-控制封面数量"><a href="#发布文章-控制封面数量" class="header-anchor">#</a> 发布文章-控制封面数量</h2> <h3 id="目标-6"><a href="#目标-6" class="header-anchor">#</a> 目标</h3> <p>能够控制封面上传数量</p> <h3 id="思路-2"><a href="#思路-2" class="header-anchor">#</a> 思路</h3> <p>利用 Upload 组件的 maxCount 属性来实现控制功能</p> <h3 id="步骤-4"><a href="#步骤-4" class="header-anchor">#</a> 步骤</h3> <ol><li>自己控制type属性</li> <li>根据type属性控制上传的数量</li></ol> <p><strong>核心代码</strong>：</p> <p>pages/Publish/index.js 中：</p> <ul><li>去除Form.Item的name属性，自己提供value和onChagne</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Form.Item</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>封面<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Radio.Group</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>type<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onTypeChange<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Radio</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">单图</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Radio</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Radio</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">三图</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Radio</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Radio</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">无图</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Radio</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Radio.Group</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Form.Item</span></span><span class="token punctuation">&gt;</span></span>

</code></pre></div><ul><li>提供value和onchange</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// 控制type属性</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>type<span class="token punctuation">,</span> setType<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">onTypeChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setType</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><ul><li>控制上传的数量</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Form.Item</span></span> <span class="token attr-name">wrapperCol</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">offset</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token literal-property property">span</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token punctuation">{</span><span class="token comment">/* 
    fileList: 控制上传的图片
    action: 上传的地址
    name: 上传的文件的名字 默认file
  */</span><span class="token punctuation">}</span><span class="token plain-text">
  &lt;Upload
    listType=&quot;picture-card&quot;
    fileList=</span><span class="token punctuation">{</span>fileList<span class="token punctuation">}</span><span class="token plain-text">
    name=&quot;image&quot;
    action=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">BASEURL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">upload</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span class="token plain-text">
    onChange=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span><span class="token plain-text">
+   maxCount=</span><span class="token punctuation">{</span>type<span class="token punctuation">}</span><span class="token plain-text">
  &gt;
+    </span><span class="token punctuation">{</span>fileList<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> type <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">PlusOutlined</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Upload</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Form.Item</span></span><span class="token punctuation">&gt;</span></span>

</code></pre></div><h2 id="发布文章-动态切换封面数量"><a href="#发布文章-动态切换封面数量" class="header-anchor">#</a> 发布文章-动态切换封面数量</h2> <h3 id="目标-7"><a href="#目标-7" class="header-anchor">#</a> 目标</h3> <p>能够实现动态切换封面数量</p> <ul><li>问题：如果当前有 3 张图，选择单图只显示一张，再切换到三图继续显示三张，该如何实现？
<ul><li>3张 -&gt; 1张</li> <li>1张 -&gt; 3张？？？</li> <li>思路：通过 ref 存储所有图片，需要几张就展示几张。也就是把 ref 当仓库，用多少拿多少</li></ul></li></ul> <h3 id="步骤-5"><a href="#步骤-5" class="header-anchor">#</a> 步骤</h3> <ol><li>创建 ref 对象，用来存储已上传图片</li> <li>如果是单图，只展示第一张图片</li> <li>如果是三图，展示所有图片</li></ol> <h3 id="核心代码-3"><a href="#核心代码-3" class="header-anchor">#</a> 核心代码</h3> <p>pages/Publish/index.js 中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>fileList<span class="token punctuation">,</span> setFileList<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fileRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span>fileList<span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">onChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> fileList <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setFileList</span><span class="token punctuation">(</span>fileList<span class="token punctuation">)</span>
  fileRef<span class="token punctuation">.</span>current <span class="token operator">=</span> fileList
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">onTypeChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> count <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
  <span class="token function">setType</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>
  <span class="token function">setFileList</span><span class="token punctuation">(</span>fileRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="发布文章-表单的校验"><a href="#发布文章-表单的校验" class="header-anchor">#</a> 发布文章-表单的校验</h2> <h3 id="目标-8"><a href="#目标-8" class="header-anchor">#</a> 目标</h3> <p>表单校验</p> <h3 id="内容"><a href="#内容" class="header-anchor">#</a> 内容</h3> <p>标题不能为空；</p> <p>频道不能为空；</p> <p>内容不能为空；</p> <p>封面自定义规则：上传数量要和选中的数量一致</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Form.Item</span></span>
  <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>标题<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">rules</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'标题不能为空'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">}</span></span>
<span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Input</span></span>
    <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>请输入文章的标题<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">400</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
  <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Input</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Form.Item</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Form.Item</span></span>
  <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>频道<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>channel_id<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">rules</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'频道不能为空'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">}</span></span>
<span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Channel</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Form.Item</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Form.Item</span></span>
  <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>内容<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">rules</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'内容不能为空'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">}</span></span>
<span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ReactQuill</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ReactQuill</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Form.Item</span></span><span class="token punctuation">&gt;</span></span>


<span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item
  label<span class="token operator">=</span><span class="token string">&quot;封面&quot;</span>
  name<span class="token operator">=</span><span class="token string">&quot;type&quot;</span>
  rules<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token function">validator</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fileList<span class="token punctuation">.</span>length <span class="token operator">!==</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">请上传</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">张图片</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token operator">&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Radio.Group</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>type<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onTypeChange<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Radio</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">单图</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Radio</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Radio</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">三图</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Radio</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Radio</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">无图</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Radio</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Radio.Group</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Form.Item</span></span><span class="token punctuation">&gt;</span></span>

</code></pre></div><h2 id="表单校验-封面类型-优化"><a href="#表单校验-封面类型-优化" class="header-anchor">#</a> 表单校验-封面类型-优化</h2> <p><img src="asset/image-20211119170030456.png" alt="image-20211119170030456"></p> <p>问题，我们上传或者删除图片的时候，并没有修改type属性，所以不会触发type的校验</p> <p>如何手动触发表单项的校验</p> <p>格式</p> <div class="language-js extra-class"><pre class="language-js"><code>表单<span class="token punctuation">.</span><span class="token function">validateFields</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'属性名'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre></div><p>代码</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">const</span> <span class="token function-variable function">onChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> fileList <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 图片在变化</span>
  <span class="token function">setFileList</span><span class="token punctuation">(</span>fileList<span class="token punctuation">)</span>
  fileRef<span class="token punctuation">.</span>current <span class="token operator">=</span> fileList
  formRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">validateFields</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="发布文章-组装表单提交数据"><a href="#发布文章-组装表单提交数据" class="header-anchor">#</a> 发布文章-组装表单提交数据</h2> <p><strong>目标</strong>：能够在表单提交时组装表单数据
<strong>步骤</strong>：</p> <ol><li>给 Form 表单添加 onFinish 用来获取表单提交数据</li> <li>在事件处理程序中，拿到表单数据按照接口需要格式化数据</li></ol> <p><strong>核心代码</strong>：</p> <p>pages/Publish/index.js 中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">Publish</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onFinish</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">values</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 说明：如果选择 3 图，图片数量必须是 3 张，否则，后端会当做单图处理</span>
    <span class="token comment">//      后端根据上传图片数量，来识别是单图或三图</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>values<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">3</span> <span class="token operator">&amp;&amp;</span> fileList<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">3</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> message<span class="token punctuation">.</span><span class="token function">warning</span><span class="token punctuation">(</span><span class="token string">'封面数量不为3张'</span><span class="token punctuation">)</span>
    
    
    <span class="token keyword">const</span> images <span class="token operator">=</span> fileList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> item<span class="token punctuation">.</span>url
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> item<span class="token punctuation">.</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>url
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> <span class="token operator">...</span>rest <span class="token punctuation">}</span> <span class="token operator">=</span> values
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>rest<span class="token punctuation">,</span>
      <span class="token comment">// 注意：接口会按照上传图片数量来决定单图 或 三图</span>
      <span class="token literal-property property">cover</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">,</span>
        images
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'接口需要的数据格式：'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="发布文章-提交数据-完成发布"><a href="#发布文章-提交数据-完成发布" class="header-anchor">#</a> 发布文章-提交数据-完成发布</h2> <h3 id="目标-9"><a href="#目标-9" class="header-anchor">#</a> 目标</h3> <p>能够提交数据并返回内容管理页面</p> <h3 id="步骤-6"><a href="#步骤-6" class="header-anchor">#</a> 步骤</h3> <ol><li>在组装表单提交数据后，分发提交数据的异步 action</li> <li>在 action 中拿到数据并发送请求</li> <li>提交数据后，返回到内容管理页面</li></ol> <h3 id="核心代码-4"><a href="#核心代码-4" class="header-anchor">#</a> 核心代码</h3> <p>pages/Publish/index.jz 中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> saveArticle <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/store/actions'</span>

<span class="token keyword">const</span> <span class="token function-variable function">Publish</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onFinish</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">saveArticle</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>

      message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">'发布成功'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/home/article'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>actions/article.js 中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">saveArticle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/mp/articles?draft=false'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="发布文章-存入草稿"><a href="#发布文章-存入草稿" class="header-anchor">#</a> 发布文章-存入草稿</h2> <h3 id="目标-10"><a href="#目标-10" class="header-anchor">#</a> 目标</h3> <p>点击存入草稿</p> <h3 id="分析"><a href="#分析" class="header-anchor">#</a> 分析</h3> <p>存入草稿功能类似于发布文章，只是 draft 值为true，所以，可以复用发布文章的逻辑</p> <h3 id="在非提交按钮中获取到表单数据"><a href="#在非提交按钮中获取到表单数据" class="header-anchor">#</a> 在非提交按钮中获取到表单数据</h3> <p>如果要在非提交按钮中获取到表单数据，需要通过调用 Form 的实例方法来实现。有两个方法：</p> <ol><li><code>getFieldsValue()</code> 仅获取表单数据，不进行表单校验</li> <li><code>validateFields()</code> 先进行表单校验，再获取表单数据【此处，使用该方法】</li></ol> <h3 id="步骤-7"><a href="#步骤-7" class="header-anchor">#</a> 步骤</h3> <ol start="2"><li>为<strong>存入草稿</strong>按钮绑定点击事件</li> <li>在事件中，调用表单对象（用useRef来获取）的 validateFields 方法，先进行表单校验再获取表单值</li></ol> <h3 id="核心代码-5"><a href="#核心代码-5" class="header-anchor">#</a> 核心代码</h3> <p>pages/Publish/index.jz 中：</p> <ul><li>给草稿注册点击事件</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>addDraft<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">存入草稿</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span>

</code></pre></div><ul><li>对表单进行校验，且获取到表单的值</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">const</span> <span class="token function-variable function">addDraft</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> values <span class="token operator">=</span> <span class="token keyword">await</span> formRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">validateFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">add</span><span class="token punctuation">(</span>values<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

</code></pre></div><p>封装了添加文章的方法</p> <p>提炼add</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">values<span class="token punctuation">,</span> draft <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> <span class="token operator">...</span>rest <span class="token punctuation">}</span> <span class="token operator">=</span> values
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>rest<span class="token punctuation">,</span>
      <span class="token comment">// 注意：接口会按照上传图片数量来决定单图 或 三图</span>
      <span class="token literal-property property">cover</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">,</span>
        <span class="token literal-property property">images</span><span class="token operator">:</span> fileList
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'接口需要的数据格式：'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">saveArticle</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> draft<span class="token punctuation">)</span><span class="token punctuation">)</span>

      message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">'发布成功'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/home/article'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>response<span class="token punctuation">.</span>message<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>


<span class="token keyword">const</span> <span class="token function-variable function">onFinish</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">values</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">add</span><span class="token punctuation">(</span>values，<span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">addDraft</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> values <span class="token operator">=</span> <span class="token keyword">await</span> formRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">validateFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">add</span><span class="token punctuation">(</span>values，<span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="编辑文章-展示编辑文章文案"><a href="#编辑文章-展示编辑文章文案" class="header-anchor">#</a> 编辑文章-展示编辑文章文案</h2> <p><strong>目标</strong>：能够在编辑文章时展示编辑文章时的文案
<strong>步骤</strong>：</p> <ol><li>通过路由参数拿到文章id</li> <li>根据文章 id 是否存在判断是否为编辑状态</li> <li>如果是编辑状态，展示编辑时的文案信息</li></ol> <p><strong>核心代码</strong></p> <h3 id="补充动态路由"><a href="#补充动态路由" class="header-anchor">#</a> 补充动态路由</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>Switch<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">&quot;/home&quot;</span> exact component<span class="token operator">=</span><span class="token punctuation">{</span>Index<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">&quot;/home/list&quot;</span> component<span class="token operator">=</span><span class="token punctuation">{</span>List<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">&quot;/home/publish&quot;</span> exact component<span class="token operator">=</span><span class="token punctuation">{</span>Publish<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">&quot;/home/publish/:id&quot;</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Publish<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">&gt;</span>

</code></pre></div><h3 id="是否编辑"><a href="#是否编辑" class="header-anchor">#</a> 是否编辑</h3> <p>pages/Publish/index.js 中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useParams <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token punctuation">{</span>id <span class="token operator">?</span> <span class="token string">'编辑'</span> <span class="token operator">:</span> <span class="token string">'发布'</span><span class="token punctuation">}</span>文章

</code></pre></div><h2 id="编辑文章-填充文章数据"><a href="#编辑文章-填充文章数据" class="header-anchor">#</a> 编辑文章-填充文章数据</h2> <p><strong>目标</strong>：能够在编辑文章时在表单中展示文章数据</p> <p>分析：</p> <ul><li>动态给表单设置数据，需要调用表单的实例方法：<code>setFieldsValue({属性名：属性值,...})</code></li></ul> <p><strong>步骤</strong>：</p> <ol><li>判断文章 id 是否存在，如果存在就根据 id 获取文章详情数据</li> <li>格式化文章数据，展示在表单中</li></ol> <p><strong>核心代码</strong>：</p> <p>pages/Publish/index.js 中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token function-variable function">getInfo</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'useEffect'</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> articleInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">getArticleInfo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文章详情'</span><span class="token punctuation">,</span> articleInfo<span class="token punctuation">)</span>

          <span class="token keyword">const</span> article <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> articleInfo<span class="token punctuation">.</span>cover<span class="token punctuation">.</span>type<span class="token punctuation">,</span> <span class="token comment">// 图片类型</span>
            <span class="token literal-property property">content</span><span class="token operator">:</span> articleInfo<span class="token punctuation">.</span>content<span class="token punctuation">,</span>
            <span class="token literal-property property">channel_id</span><span class="token operator">:</span> articleInfo<span class="token punctuation">.</span>channel_id<span class="token punctuation">,</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> articleInfo<span class="token punctuation">.</span>title
          <span class="token punctuation">}</span>

          refForm<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">setFieldsValue</span><span class="token punctuation">(</span>article<span class="token punctuation">)</span>
          <span class="token comment">// 按upload组件的要求对封面进行转换</span>
          <span class="token function">setFileList</span><span class="token punctuation">(</span>articleInfo<span class="token punctuation">.</span>cover<span class="token punctuation">.</span>images<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">img</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">url</span><span class="token operator">:</span> img <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 显示封面图片</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token function">getInfo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span>
  <span class="token punctuation">)</span>

</code></pre></div><p>actions/article.js 中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getArticleInfo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/mp/articles/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span>data
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="编辑文章-编辑或存入草稿"><a href="#编辑文章-编辑或存入草稿" class="header-anchor">#</a> 编辑文章-编辑或存入草稿</h2> <h3 id="目标-11"><a href="#目标-11" class="header-anchor">#</a> 目标</h3> <p>能够在编辑文章时对文章进行修改或存入草稿</p> <h3 id="分析-2"><a href="#分析-2" class="header-anchor">#</a> 分析</h3> <ul><li>编辑时修改文章或存入草稿的功能，类似于发布时的发布和存入草稿</li> <li>可以继续复用之前的逻辑</li></ul> <h3 id="核心代码-6"><a href="#核心代码-6" class="header-anchor">#</a> <strong>核心代码</strong></h3> <p>pages/Publish/index.js 中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">draft<span class="token punctuation">,</span> values</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> images <span class="token operator">=</span> fileList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> item<span class="token punctuation">.</span>url
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> item<span class="token punctuation">.</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>url
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>values<span class="token punctuation">,</span>
    <span class="token literal-property property">cover</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> type<span class="token punctuation">,</span>
      <span class="token literal-property property">images</span><span class="token operator">:</span> images
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 修改</span>
    <span class="token keyword">await</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>
      <span class="token function">editArticle</span><span class="token punctuation">(</span>draft<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>data<span class="token punctuation">,</span>
        id
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 新增</span>
    <span class="token keyword">await</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addArticle</span><span class="token punctuation">(</span>draft<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">'操作成功'</span><span class="token punctuation">)</span>
  history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/home/article'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>actions/article.js 中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">editArticle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">draft <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/mp/articles/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'put'</span><span class="token punctuation">,</span>
      data<span class="token punctuation">,</span>
      <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        draft
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="发布文章菜单高亮处理"><a href="#发布文章菜单高亮处理" class="header-anchor">#</a> 发布文章菜单高亮处理</h2> <p>问题</p> <p>从列表页跳入</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">const</span> history <span class="token operator">=</span> <span class="token function">useHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> pathname <span class="token operator">=</span> history<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pathname<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'/home/publish'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pathname <span class="token operator">=</span> <span class="token string">'/home/publish'</span>
  <span class="token punctuation">}</span>



selectedKeys<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>pathname<span class="token punctuation">]</span><span class="token punctuation">}</span>

</code></pre></div><h2 id="发布文章-编辑文章切换"><a href="#发布文章-编辑文章切换" class="header-anchor">#</a> 发布文章-编辑文章切换</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>Route
                  path<span class="token operator">=</span><span class="token string">&quot;/home/publish&quot;</span>
                  key<span class="token operator">=</span><span class="token string">&quot;add&quot;</span>
                  exact
                  component<span class="token operator">=</span><span class="token punctuation">{</span>Publish<span class="token punctuation">}</span>
                <span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>Route
                  path<span class="token operator">=</span><span class="token string">&quot;/home/publish/:id&quot;</span>
                  key<span class="token operator">=</span><span class="token string">&quot;edit&quot;</span>
                  component<span class="token operator">=</span><span class="token punctuation">{</span>Publish<span class="token punctuation">}</span>
                <span class="token operator">/</span><span class="token operator">&gt;</span>

</code></pre></div><h2 id="拓展-发布文章-图片预览功能"><a href="#拓展-发布文章-图片预览功能" class="header-anchor">#</a> 拓展-发布文章-图片预览功能</h2> <p>步骤：</p> <ol><li>需要upload提供onPreview</li></ol> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Upload</span></span>
  <span class="token attr-name">listType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>picture-card<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">fileList</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>fileList<span class="token punctuation">}</span></span>
  <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>image<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">action</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">REACT_APP_URL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">upload</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span></span>
  <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span></span>
  <span class="token attr-name">maxCount</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>type<span class="token punctuation">}</span></span>
  <span class="token attr-name">onPreview</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onPreview<span class="token punctuation">}</span></span>
<span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token punctuation">{</span>fileList<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> type <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">PlusOutlined</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Upload</span></span><span class="token punctuation">&gt;</span></span>

</code></pre></div><ol start="2"><li>准备一个dialog,用于展示图片</li></ol> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Modal</span></span>
  <span class="token attr-name">width</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">800</span><span class="token punctuation">}</span></span>
  <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>图片预览<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">visible</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>isVisible<span class="token punctuation">}</span></span>
  <span class="token attr-name">footer</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">null</span><span class="token punctuation">}</span></span>
  <span class="token attr-name">onCancel</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setIsVisible</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">textAlign</span><span class="token operator">:</span> <span class="token string">'center'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>preview<span class="token punctuation">}</span></span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">600</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Modal</span></span><span class="token punctuation">&gt;</span></span>

</code></pre></div><ol start="3"><li>控制dialog的显示和隐藏以及预览的图片</li></ol> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>isVisible<span class="token punctuation">,</span> setIsVisible<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>preview<span class="token punctuation">,</span> setPreview<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">onPreview</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
  <span class="token function">setIsVisible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token function">setPreview</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>url <span class="token operator">||</span> file<span class="token punctuation">.</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/jiely/chapter3/04-文章列表.html" class="prev">
        内容管理整体说明
      </a></span> <span class="next"><a href="/jiely/chapter3/06-打包优化.html">
        项目打包和优化-项目打包
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/jiely/assets/js/app.87156db4.js" defer></script><script src="/jiely/assets/js/3.05e47443.js" defer></script><script src="/jiely/assets/js/30.117590fb.js" defer></script>
  </body>
</html>
