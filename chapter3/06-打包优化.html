<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>项目打包和优化-项目打包 | react 快速上手</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="shortcut icon" type="image/x-icon" href="./images/favicon.ico">
    <meta name="description" content="杰哥哥前端研究院">
    
    <link rel="preload" href="/jiely/assets/css/0.styles.5afc0e25.css" as="style"><link rel="preload" href="/jiely/assets/js/app.77e16281.js" as="script"><link rel="preload" href="/jiely/assets/js/3.23c74d3c.js" as="script"><link rel="preload" href="/jiely/assets/js/27.72b6ee76.js" as="script"><link rel="prefetch" href="/jiely/assets/js/10.7a1d5359.js"><link rel="prefetch" href="/jiely/assets/js/11.825d4d37.js"><link rel="prefetch" href="/jiely/assets/js/12.34a617ee.js"><link rel="prefetch" href="/jiely/assets/js/13.e956d670.js"><link rel="prefetch" href="/jiely/assets/js/14.24f14c4e.js"><link rel="prefetch" href="/jiely/assets/js/15.145280c2.js"><link rel="prefetch" href="/jiely/assets/js/16.8aed0633.js"><link rel="prefetch" href="/jiely/assets/js/17.55a0e136.js"><link rel="prefetch" href="/jiely/assets/js/18.6663a467.js"><link rel="prefetch" href="/jiely/assets/js/19.1d02f7a7.js"><link rel="prefetch" href="/jiely/assets/js/2.a217f65b.js"><link rel="prefetch" href="/jiely/assets/js/20.402bbfbb.js"><link rel="prefetch" href="/jiely/assets/js/21.13ffb241.js"><link rel="prefetch" href="/jiely/assets/js/22.9baa51a1.js"><link rel="prefetch" href="/jiely/assets/js/23.8b2d09f5.js"><link rel="prefetch" href="/jiely/assets/js/24.88446b74.js"><link rel="prefetch" href="/jiely/assets/js/25.212136bd.js"><link rel="prefetch" href="/jiely/assets/js/26.ab4c3f14.js"><link rel="prefetch" href="/jiely/assets/js/28.7a75f195.js"><link rel="prefetch" href="/jiely/assets/js/29.20892189.js"><link rel="prefetch" href="/jiely/assets/js/30.7e88f712.js"><link rel="prefetch" href="/jiely/assets/js/31.dd681bb1.js"><link rel="prefetch" href="/jiely/assets/js/32.56daaef6.js"><link rel="prefetch" href="/jiely/assets/js/33.6a8234af.js"><link rel="prefetch" href="/jiely/assets/js/34.e75e2562.js"><link rel="prefetch" href="/jiely/assets/js/35.d15b5258.js"><link rel="prefetch" href="/jiely/assets/js/36.f706c7a4.js"><link rel="prefetch" href="/jiely/assets/js/37.02d520ec.js"><link rel="prefetch" href="/jiely/assets/js/38.3f565c1d.js"><link rel="prefetch" href="/jiely/assets/js/39.aac2a5de.js"><link rel="prefetch" href="/jiely/assets/js/4.8fe307c4.js"><link rel="prefetch" href="/jiely/assets/js/40.6ebf4f70.js"><link rel="prefetch" href="/jiely/assets/js/41.80e54647.js"><link rel="prefetch" href="/jiely/assets/js/42.b09ba0a7.js"><link rel="prefetch" href="/jiely/assets/js/43.4f1aa9ba.js"><link rel="prefetch" href="/jiely/assets/js/44.81f24246.js"><link rel="prefetch" href="/jiely/assets/js/45.b1f0b963.js"><link rel="prefetch" href="/jiely/assets/js/46.d01ff1ff.js"><link rel="prefetch" href="/jiely/assets/js/47.09ac9b9d.js"><link rel="prefetch" href="/jiely/assets/js/48.7c874e95.js"><link rel="prefetch" href="/jiely/assets/js/49.0931d234.js"><link rel="prefetch" href="/jiely/assets/js/5.8a58ce3d.js"><link rel="prefetch" href="/jiely/assets/js/6.9b54027d.js"><link rel="prefetch" href="/jiely/assets/js/7.f308a72a.js"><link rel="prefetch" href="/jiely/assets/js/8.a7efc970.js"><link rel="prefetch" href="/jiely/assets/js/9.1f369830.js">
    <link rel="stylesheet" href="/jiely/assets/css/0.styles.5afc0e25.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/jiely/" class="home-link router-link-active"><img src="/jiely/images/logo.jpg" alt="react 快速上手" class="logo"> <span class="site-name can-hide">react 快速上手</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://juejin.cn/post/7097067108663558151" target="_blank" rel="noopener noreferrer" class="nav-link external">
  50+Vue经典面试题源码级
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://segmentfault.com/a/1190000018604138" target="_blank" rel="noopener noreferrer" class="nav-link external">
  react面试题
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://juejin.cn/post/6844904055840440334" target="_blank" rel="noopener noreferrer" class="nav-link external">
  从零React项目
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://summerjie007.github.io/vue3_study/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue3+TS
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/airbnb/javascript" target="_blank" rel="noopener noreferrer" class="nav-link external">
  代码规范
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://juejin.cn/post/7097067108663558151" target="_blank" rel="noopener noreferrer" class="nav-link external">
  50+Vue经典面试题源码级
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://segmentfault.com/a/1190000018604138" target="_blank" rel="noopener noreferrer" class="nav-link external">
  react面试题
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://juejin.cn/post/6844904055840440334" target="_blank" rel="noopener noreferrer" class="nav-link external">
  从零React项目
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://summerjie007.github.io/vue3_study/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue3+TS
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/airbnb/javascript" target="_blank" rel="noopener noreferrer" class="nav-link external">
  代码规范
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/jiely/00_课程介绍.html" class="sidebar-link">课程指南</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>一.react全家桶上手</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>二.react全家桶项目</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>01-项目搭建</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>02-登录功能</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>03-首页</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>04-文章列表</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>05-发布与编辑文章</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>06-打包优化</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jiely/chapter3/06-打包优化.html" class="active sidebar-link">项目打包和优化-项目打包</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jiely/chapter3/06-打包优化.html#项目打包和优化-项目打包" class="sidebar-link">项目打包和优化-项目打包</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter3/06-打包优化.html#项目打包和优化-项目本地预览" class="sidebar-link">项目打包和优化-项目本地预览</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter3/06-打包优化.html#项目打包和优化-打包体积分析" class="sidebar-link">项目打包和优化-打包体积分析</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter3/06-打包优化.html#项目打包和优化-生产环境优化" class="sidebar-link">项目打包和优化-生产环境优化</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter3/06-打包优化.html#项目打包和优化-路由懒加载" class="sidebar-link">项目打包和优化-路由懒加载</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter3/06-打包优化.html#项目打包和优化-去掉console" class="sidebar-link">项目打包和优化-去掉console</a></li><li class="sidebar-sub-header"><a href="/jiely/chapter3/06-打包优化.html#项目打包和优化-配置cdn" class="sidebar-link">项目打包和优化-配置CDN</a></li></ul></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>三.前端算法之道</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>四.JS设计设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>五.JS报错总结</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>六.Vue3+Pinia</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>七.node.js</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="项目打包和优化-项目打包"><a href="#项目打包和优化-项目打包" class="header-anchor">#</a> 项目打包和优化-项目打包</h2> <p><strong>目标</strong>：能够通过命令对项目进行打包
<strong>步骤</strong>：</p> <ol><li>在项目根目录打开终端，输入打包命令：<code>npm run build</code></li> <li>等待打包完成，打包后的内容被放在项目根下的 build 文件夹中</li></ol> <h2 id="项目打包和优化-项目本地预览"><a href="#项目打包和优化-项目本地预览" class="header-anchor">#</a> 项目打包和优化-项目本地预览</h2> <p><strong>目标</strong>：能够在本地预览打包后的项目
<strong>步骤</strong>：</p> <ol><li>全局安装本地服务包：<code>npm i -g serve</code>，该包提供了 <code>serve</code> 命令，用来启动本地服务</li> <li>在项目根目录中执行命令：<code>serve -s ./build</code>，在 build 目录中开启服务器</li> <li>在浏览器中访问：<code>http://localhost:5000/</code> 预览项目</li></ol> <h2 id="项目打包和优化-打包体积分析"><a href="#项目打包和优化-打包体积分析" class="header-anchor">#</a> 项目打包和优化-打包体积分析</h2> <p><strong>目标</strong>：能够分析项目打包体积</p> <p><strong>分析说明</strong>：通过分析打包体积，才能知道项目中的哪部分内容体积过大，才能知道如何来优化</p> <p><strong>步骤</strong>：</p> <ol><li><p>安装分析打包体积的包：<code>npm i source-map-explorer</code></p></li> <li><p>在 package.json 中的 scripts 标签中，添加分析打包体积的命令</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;analyze&quot;</span><span class="token operator">:</span> <span class="token string">&quot;source-map-explorer 'build/static/js/*.js'&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>对项目打包：<code>npm run build</code>（如果已经打过包，可省略这一步）</p></li> <li><p>运行分析命令：<code>npm run analyze</code></p></li> <li><p>通过浏览器打开的页面，分析图表中的包体积</p></li></ol> <p><strong>核心代码</strong>：</p> <h2 id="项目打包和优化-生产环境优化"><a href="#项目打包和优化-生产环境优化" class="header-anchor">#</a> 项目打包和优化-生产环境优化</h2> <p><strong>目标</strong>：能够根据是否为生产环境对redux中间件进行优化
<strong>核心代码</strong>：</p> <p>store/index.js 中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> middlewares

<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 生产环境，只启用 thunk 中间件</span>
  middlewares <span class="token operator">=</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  middlewares <span class="token operator">=</span> <span class="token function">composeWithDevTools</span><span class="token punctuation">(</span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="项目打包和优化-路由懒加载"><a href="#项目打包和优化-路由懒加载" class="header-anchor">#</a> 项目打包和优化-路由懒加载</h2> <p><strong>目标</strong>：能够对路由进行懒加载实现代码分隔
<strong>步骤</strong>：</p> <ol><li>在 App 组件中，导入 Suspense 组件</li> <li>在 Router 内部，使用 Suspense 组件包裹组件内容</li> <li>为 Suspense 组件提供 fallback 属性，指定 loading 占位内容</li> <li>导入 lazy 函数，并修改为懒加载方式导入路由组件</li></ol> <p><strong>核心代码</strong>：</p> <p>App.js 中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> lazy<span class="token punctuation">,</span> Suspense <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token comment">// 导入页面组件</span>
<span class="token keyword">const</span> Login <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./pages/Login'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Layout <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./pages/Layout'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Router history<span class="token operator">=</span><span class="token punctuation">{</span>history<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Suspense
        fallback<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&lt;</span>div
            style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
              <span class="token literal-property property">textAlign</span><span class="token operator">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span>
              <span class="token literal-property property">marginTop</span><span class="token operator">:</span> <span class="token number">200</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token operator">&gt;</span>
            loading<span class="token operator">...</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">}</span>
      <span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>Route exact path<span class="token operator">=</span><span class="token string">&quot;/&quot;</span> render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>Redirect to<span class="token operator">=</span><span class="token string">&quot;/home&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">&quot;/login&quot;</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Login<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>AuthRoute path<span class="token operator">=</span><span class="token string">&quot;/home&quot;</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Layout<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>AuthRoute<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Router<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App
</code></pre></div><p>pages/Layout/index.js 中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用 lazy 导入组件</span>
<span class="token keyword">const</span> Home <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../Home'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Article <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../Article'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Publish <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../Publish'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// ...</span>
</code></pre></div><h2 id="项目打包和优化-去掉console"><a href="#项目打包和优化-去掉console" class="header-anchor">#</a> 项目打包和优化-去掉console</h2> <p><code>npm i terser-webpack-plugin@4.2.3</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">webpack</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 省略其他...</span>
		<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">terserOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">compress</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">drop_console</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span> 
            <span class="token comment">// 生产环境下移除控制台所有的内容</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="项目打包和优化-配置cdn"><a href="#项目打包和优化-配置cdn" class="header-anchor">#</a> 项目打包和优化-配置CDN</h2> <p><strong>目标</strong>：能够对第三方包使用CDN优化</p> <ol><li>打包的时候不打包进来</li> <li>在public/index.html中引入外部链接</li></ol> <p><strong>分析说明</strong>：通过 craco 来修改 webpack 配置，从而实现 CDN 优化</p> <p>https://github.com/facebook/create-react-app/issues/10364</p> <p><strong>核心代码</strong>：</p> <p>craco.config.js 中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token comment">// HtmlWebpackPlugin</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> whenProd<span class="token punctuation">,</span> getPlugin<span class="token punctuation">,</span> pluginByName <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@craco/craco'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">webpack</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'@'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">configure</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">webpackConfig</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> cdn <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">js</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 对webpack进行配置</span>
      <span class="token function">whenProd</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 只会在生产环境执行</span>
        webpackConfig<span class="token punctuation">.</span>externals <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">react</span><span class="token operator">:</span> <span class="token string">'React'</span><span class="token punctuation">,</span>
          <span class="token string-property property">'react-dom'</span><span class="token operator">:</span> <span class="token string">'ReactDOM'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">redux</span><span class="token operator">:</span> <span class="token string">'Redux'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>

        cdn <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">js</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">'https://cdn.bootcdn.net/ajax/libs/react/17.0.2/umd/react.production.min.js'</span><span class="token punctuation">,</span>
            <span class="token string">'https://cdn.bootcdn.net/ajax/libs/react-dom/17.0.2/umd/react-dom.production.min.js'</span><span class="token punctuation">,</span>
            <span class="token string">'https://cdn.bootcdn.net/ajax/libs/redux/4.1.0/redux.min.js'</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token keyword">const</span> <span class="token punctuation">{</span> isFound<span class="token punctuation">,</span> match <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getPlugin</span><span class="token punctuation">(</span>
        webpackConfig<span class="token punctuation">,</span>
        <span class="token function">pluginByName</span><span class="token punctuation">(</span><span class="token string">'HtmlWebpackPlugin'</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>isFound<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 找到了html的插件</span>
        match<span class="token punctuation">.</span>options<span class="token punctuation">.</span>cdn <span class="token operator">=</span> cdn
      <span class="token punctuation">}</span>

      <span class="token keyword">return</span> webpackConfig
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>public/index.html 中：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>%PUBLIC_URL%/favicon.ico<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>theme-color<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#000000<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span>
      <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>description<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Web site created using create-react-app<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>apple-touch-icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>%PUBLIC_URL%/logo192.png<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>manifest<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>%PUBLIC_URL%/manifest.json<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike &quot;/favicon.ico&quot; or &quot;favicon.ico&quot;, &quot;%PUBLIC_URL%/favicon.ico&quot; will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>React App<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    &lt;% htmlWebpackPlugin.options.cdn.css.forEach(cdnURL =&gt; { %&gt;
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>&lt;%= cdnURL %&gt;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>link</span><span class="token punctuation">&gt;</span></span>
    &lt;% }) %&gt;
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>noscript</span><span class="token punctuation">&gt;</span></span>You need to enable JavaScript to run this app.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>noscript</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the &lt;body&gt; tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    --&gt;</span>
    &lt;% htmlWebpackPlugin.options.cdn.js.forEach(cdnURL =&gt; { %&gt;
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>&lt;%= cdnURL %&gt;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    &lt;% }) %&gt;
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/jiely/chapter3/05-发布与编辑文章.html" class="prev">
        发布文章-基本结构
      </a></span> <span class="next"><a href="/jiely/chapter4/前端算法入门一.html">
        前端算法入门一：刷算法题常用的JS基础扫盲
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/jiely/assets/js/app.77e16281.js" defer></script><script src="/jiely/assets/js/3.23c74d3c.js" defer></script><script src="/jiely/assets/js/27.72b6ee76.js" defer></script>
  </body>
</html>
